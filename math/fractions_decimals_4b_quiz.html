<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unidad 4b: Fracciones y Decimales - Quiz Interactivo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: 
                radial-gradient(circle at 10% 20%, rgba(255, 107, 107, 0.15) 0%, transparent 30%),
                radial-gradient(circle at 90% 80%, rgba(78, 205, 196, 0.15) 0%, transparent 30%),
                radial-gradient(circle at 50% 50%, rgba(255, 230, 109, 0.1) 0%, transparent 40%),
                linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
        }

        /* Floating math symbols decoration */
        body::after {
            content: '√∑ √ó + ‚àí = ‚Öì ‚Öî ¬º ¬Ω';
            position: fixed;
            top: 50%;
            left: -100px;
            font-size: 3rem;
            color: rgba(255,255,255,0.03);
            letter-spacing: 50px;
            transform: rotate(90deg);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            text-align: center;
            color: #a0a0a0;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        /* Translation Toggle */
        .translation-toggle {
            text-align: center;
            margin-bottom: 20px;
        }

        .toggle-switch {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            color: #ccc;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            width: 50px;
            height: 26px;
            background-color: #444;
            border-radius: 26px;
            position: relative;
            transition: 0.3s;
        }

        .slider:before {
            content: "";
            position: absolute;
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            border-radius: 50%;
            transition: 0.3s;
        }

        .toggle-switch input:checked + .slider {
            background-color: #4CAF50;
        }

        .toggle-switch input:checked + .slider:before {
            transform: translateX(24px);
        }

        /* Timer and Progress */
        .stats-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.1);
            padding: 15px 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4CAF50;
        }

        .timer.warning {
            color: #ff9800;
        }

        .timer.danger {
            color: #f44336;
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        @keyframes floatReverse {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(20px) rotate(-5deg); }
        }

        .floating-icon {
            position: fixed;
            font-size: 2.5rem;
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
            animation: float 6s ease-in-out infinite;
        }

        .floating-icon:nth-child(even) {
            animation: floatReverse 8s ease-in-out infinite;
        }

        .floating-icon.icon-1 { top: 10%; left: 5%; animation-delay: 0s; }
        .floating-icon.icon-2 { top: 20%; right: 8%; animation-delay: 1s; }
        .floating-icon.icon-3 { top: 60%; left: 3%; animation-delay: 2s; }
        .floating-icon.icon-4 { top: 75%; right: 5%; animation-delay: 3s; }
        .floating-icon.icon-5 { top: 40%; right: 3%; animation-delay: 4s; }
        .floating-icon.icon-6 { bottom: 15%; left: 8%; animation-delay: 5s; }

        .progress {
            font-size: 1.1rem;
        }

        .score {
            font-size: 1.1rem;
            color: #4CAF50;
        }

        /* Question Card */
        .question-card {
            background: rgba(255,255,255,0.95);
            color: #333;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .category-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .category-ordering { background: #e3f2fd; color: #1565c0; }
        .category-comparing { background: #f3e5f5; color: #7b1fa2; }
        .category-converting { background: #e8f5e9; color: #2e7d32; }
        .category-adding { background: #fff3e0; color: #e65100; }
        .category-numberline { background: #fce4ec; color: #c2185b; }
        .category-grids { background: #e0f7fa; color: #00838f; }

        .question-text {
            font-size: 1.3rem;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        /* Translatable words */
        .translatable {
            position: relative;
            border-bottom: 1px dotted #666;
            cursor: help;
        }

        .translatable .translation {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            white-space: nowrap;
            z-index: 100;
        }

        .translatable:hover .translation,
        .show-translations .translatable .translation {
            display: block;
        }

        /* Math display */
        .fraction {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            vertical-align: middle;
            margin: 0 5px;
            font-size: 1.1em;
        }

        .fraction .numerator {
            border-bottom: 2px solid #333;
            padding: 0 5px 2px;
        }

        .fraction .denominator {
            padding: 2px 5px 0;
        }

        .mixed-number {
            display: inline-flex;
            align-items: center;
            gap: 3px;
        }

        .decimal-display {
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            font-weight: bold;
            color: #1565c0;
        }

        /* Answer Options */
        .options {
            display: grid;
            gap: 12px;
        }

        .option {
            padding: 18px 25px;
            background: #f5f5f5;
            border: 3px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .option:hover {
            background: #e8e8e8;
            transform: translateX(5px);
        }

        .option.selected {
            border-color: #2196F3;
            background: #e3f2fd;
        }

        .option.correct {
            border-color: #4CAF50;
            background: #e8f5e9;
        }

        .option.incorrect {
            border-color: #f44336;
            background: #ffebee;
        }

        .option-letter {
            width: 35px;
            height: 35px;
            background: #ddd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .option.selected .option-letter {
            background: #2196F3;
            color: white;
        }

        .option.correct .option-letter {
            background: #4CAF50;
            color: white;
        }

        .option.incorrect .option-letter {
            background: #f44336;
            color: white;
        }

        /* Multi-select indicator */
        .multi-select-hint {
            display: inline-block;
            background: #fff3e0;
            color: #e65100;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            margin-bottom: 15px;
            font-weight: 500;
        }

        /* Number Line Styles */
        .number-line {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 60px;
            margin: 20px auto;
            background: #f5f5f5;
            border-radius: 10px;
            padding: 10px 20px;
        }

        .number-line-track {
            position: absolute;
            top: 50%;
            left: 20px;
            right: 20px;
            height: 4px;
            background: #333;
            transform: translateY(-50%);
        }

        .number-line-tick {
            position: absolute;
            top: 50%;
            width: 2px;
            height: 15px;
            background: #333;
            transform: translateY(-50%);
        }

        .number-line-tick.major {
            height: 25px;
            width: 3px;
        }

        .number-line-label {
            position: absolute;
            top: 70%;
            transform: translateX(-50%);
            font-size: 0.85rem;
            font-weight: bold;
            color: #333;
        }

        .number-line-point {
            position: absolute;
            top: 50%;
            width: 16px;
            height: 16px;
            background: #e91e63;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            border: 3px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .number-line-point.blue {
            background: #2196F3;
        }

        .number-line-point.green {
            background: #4CAF50;
        }

        .point-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            font-weight: bold;
            background: inherit;
            padding: 2px 6px;
            border-radius: 4px;
            color: white;
            white-space: nowrap;
        }

        /* Decimal Grid Styles */
        .decimal-grid-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .decimal-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 1px;
            background: #333;
            padding: 1px;
            border-radius: 5px;
            width: 120px;
            height: 120px;
        }

        .decimal-grid .cell {
            background: #fff;
            transition: background 0.2s;
        }

        .decimal-grid .cell.shaded {
            background: #4CAF50;
        }

        .decimal-grid .cell.shaded-blue {
            background: #2196F3;
        }

        .grid-label {
            text-align: center;
            font-size: 0.9rem;
            margin-top: 5px;
            color: #333;
        }

        /* Interactive Number Line */
        .number-line-interactive {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 80px;
            margin: 20px auto;
            background: #f5f5f5;
            border-radius: 10px;
            padding: 10px 20px;
            cursor: crosshair;
        }

        .number-line-interactive:hover {
            background: #e8f5e9;
        }

        .user-point {
            position: absolute;
            top: 50%;
            width: 20px;
            height: 20px;
            background: #ff5722;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            border: 3px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            z-index: 10;
            display: none;
        }

        .user-point.placed {
            display: block;
            animation: pointPop 0.3s ease;
        }

        @keyframes pointPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.3); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .click-hint {
            text-align: center;
            color: #666;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        /* Interactive Grid */
        .decimal-grid-interactive {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 1px;
            background: #333;
            padding: 1px;
            border-radius: 5px;
            width: 200px;
            height: 200px;
            cursor: crosshair;
            user-select: none;
            -webkit-user-select: none;
        }

        .decimal-grid-interactive .cell {
            background: #fff;
            transition: background 0.1s;
            cursor: crosshair;
        }

        .decimal-grid-interactive .cell:hover {
            background: #c8e6c9;
            transform: scale(1.05);
        }

        .decimal-grid-interactive .cell.user-shaded {
            background: #4CAF50;
        }

        .decimal-grid-interactive .cell.user-shaded:hover {
            background: #388E3C;
        }

        .decimal-grid-interactive.grid-blue .cell.user-shaded {
            background: #2196F3;
        }

        .decimal-grid-interactive.grid-blue .cell.user-shaded:hover {
            background: #1976D2;
        }

        .decimal-grid-interactive.grid-blue .cell:hover {
            background: #bbdefb;
        }

        /* Tenths Grid (10 columns instead of 100 squares) */
        .tenths-grid-interactive {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 2px;
            background: #333;
            padding: 2px;
            border-radius: 5px;
            width: 200px;
            height: 80px;
            cursor: crosshair;
            user-select: none;
            -webkit-user-select: none;
        }

        .tenths-grid-interactive .column {
            background: #fff;
            transition: background 0.1s;
            cursor: crosshair;
            border-radius: 2px;
        }

        .tenths-grid-interactive .column:hover {
            background: #c8e6c9;
            transform: scale(1.02);
        }

        .tenths-grid-interactive .column.user-shaded {
            background: #4CAF50;
        }

        .tenths-grid-interactive .column.user-shaded:hover {
            background: #388E3C;
        }

        .shade-counter {
            text-align: center;
            font-size: 1.1rem;
            margin-top: 10px;
            color: #333;
            font-weight: bold;
        }

        /* Fill-in Number Line */
        .numberline-fill {
            position: relative;
            width: 100%;
            max-width: 550px;
            height: 100px;
            margin: 20px auto;
            background: #f5f5f5;
            border-radius: 10px;
            padding: 15px 30px;
        }

        .numberline-fill .track {
            position: absolute;
            top: 45%;
            left: 30px;
            right: 30px;
            height: 4px;
            background: #333;
        }

        .numberline-fill .tick {
            position: absolute;
            top: 45%;
            width: 2px;
            height: 20px;
            background: #333;
            transform: translateY(-50%);
        }

        .numberline-fill .tick.major {
            height: 30px;
            width: 3px;
        }

        .numberline-fill .label-fixed {
            position: absolute;
            top: 65%;
            transform: translateX(-50%);
            font-size: 0.9rem;
            font-weight: bold;
            color: #333;
        }

        .numberline-fill .label-input {
            position: absolute;
            top: 60%;
            transform: translateX(-50%);
            width: 50px;
            padding: 3px 5px;
            font-size: 0.85rem;
            text-align: center;
            border: 2px solid #2196F3;
            border-radius: 5px;
            background: #fff;
        }

        .numberline-fill .label-input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
        }

        .numberline-fill .label-input.correct {
            border-color: #4CAF50;
            background: #e8f5e9;
        }

        .numberline-fill .label-input.incorrect {
            border-color: #f44336;
            background: #ffebee;
        }

        .numberline-fill .arrow {
            position: absolute;
            top: 20%;
            transform: translateX(-50%);
            font-size: 1.2rem;
            color: #e91e63;
        }

        /* Buttons */
        .btn {
            padding: 15px 40px;
            font-size: 1.1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }

        .button-container {
            text-align: center;
            margin-top: 20px;
        }

        /* Feedback */
        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 12px;
            display: none;
        }

        .feedback.correct {
            background: #e8f5e9;
            border-left: 5px solid #4CAF50;
        }

        .feedback.incorrect {
            background: #ffebee;
            border-left: 5px solid #f44336;
        }

        .feedback h4 {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .feedback .explanation {
            color: #555;
            line-height: 1.6;
        }

        .step {
            margin: 8px 0;
            padding: 8px 12px;
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
            font-family: 'Courier New', monospace;
        }

        /* Results Screen */
        .results {
            display: none;
            text-align: center;
        }

        .results-card {
            background: rgba(255,255,255,0.95);
            color: #333;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .score-circle {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            color: white;
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4);
        }

        .score-circle.good {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
        }

        .score-circle.okay {
            background: linear-gradient(135deg, #ff9800, #ffc107);
        }

        .score-circle.needs-work {
            background: linear-gradient(135deg, #f44336, #ff5722);
        }

        .score-number {
            font-size: 3rem;
            font-weight: bold;
        }

        .score-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        .results h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .stat-item {
            padding: 20px;
            background: #f5f5f5;
            border-radius: 15px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #333;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* Category Breakdown */
        .category-breakdown {
            text-align: left;
            margin: 30px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 15px;
        }

        .category-breakdown h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .category-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .category-row:last-child {
            border-bottom: none;
        }

        .category-name {
            font-weight: 500;
        }

        .category-score {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .category-score.excellent { background: #e8f5e9; color: #2e7d32; }
        .category-score.good { background: #fff3e0; color: #e65100; }
        .category-score.needs-practice { background: #ffebee; color: #c62828; }

        /* Review Section */
        .review-section {
            text-align: left;
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #fff9c4, #fff59d);
            border-radius: 15px;
            border-left: 5px solid #fbc02d;
        }

        .review-section h3 {
            color: #f57f17;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .review-section ul {
            margin-left: 20px;
            color: #555;
        }

        .review-section li {
            margin: 10px 0;
            line-height: 1.5;
        }

        /* Start Screen */
        .start-screen {
            text-align: center;
        }

        .start-card {
            background: rgba(255,255,255,0.95);
            color: #333;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .topic-list {
            text-align: left;
            max-width: 400px;
            margin: 20px auto;
        }

        .topic-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .topic-icon {
            font-size: 1.5rem;
        }

        .instructions {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }

        .instructions h4 {
            margin-bottom: 10px;
            color: #1565c0;
        }

        .instructions ul {
            margin-left: 20px;
            color: #555;
        }

        .instructions li {
            margin: 5px 0;
        }

        /* Responsive */
        @media (max-width: 600px) {
            h1 { font-size: 1.5rem; }
            .question-text { font-size: 1.1rem; }
            .stats-grid { grid-template-columns: 1fr; }
            .option { padding: 15px; font-size: 1rem; }
        }
    </style>
</head>
<body>
    <!-- Floating decorations -->
    <div class="floating-icon icon-1">üìê</div>
    <div class="floating-icon icon-2">üî¢</div>
    <div class="floating-icon icon-3">‚úèÔ∏è</div>
    <div class="floating-icon icon-4">üìä</div>
    <div class="floating-icon icon-5">üßÆ</div>
    <div class="floating-icon icon-6">‚≠ê</div>

    <div class="container">
        <h1>üìê Unidad 4b: Fracciones y Decimales</h1>
        <p class="subtitle">Investigating Fractions and Decimals</p>

        <!-- Translation Toggle -->
        <div class="translation-toggle">
            <label class="toggle-switch">
                <span>üá∫üá∏ Show English Translations</span>
                <input type="checkbox" id="translationToggle">
                <span class="slider"></span>
            </label>
        </div>

        <!-- Start Screen -->
        <div id="startScreen" class="start-screen">
            <div class="start-card">
                <h2>üéØ Ready to Practice?</h2>
                
                <div class="topic-list">
                    <div class="topic-item">
                        <span class="topic-icon">üìä</span>
                        <span><strong>Ordering Decimals</strong> - Menor a mayor</span>
                    </div>
                    <div class="topic-item">
                        <span class="topic-icon">‚öñÔ∏è</span>
                        <span><strong>Comparing Decimals</strong> - >, <, =</span>
                    </div>
                    <div class="topic-item">
                        <span class="topic-icon">üìè</span>
                        <span><strong>Number Lines</strong> - Visual comparisons!</span>
                    </div>
                    <div class="topic-item">
                        <span class="topic-icon">üü©</span>
                        <span><strong>Decimal Grids</strong> - Shading & reading</span>
                    </div>
                    <div class="topic-item">
                        <span class="topic-icon">üîÑ</span>
                        <span><strong>Converting</strong> - Fractions ‚Üî Decimals</span>
                    </div>
                    <div class="topic-item">
                        <span class="topic-icon">‚ûï</span>
                        <span><strong>Adding Fractions</strong> - Same denominator!</span>
                    </div>
                </div>
                
                <p style="color: #666; font-size: 0.9rem; margin-top: 15px;">
                    üé≤ <em>New numbers generated each time for extra practice!</em>
                </p>

                <div class="instructions">
                    <h4>üìã Instructions / Instrucciones:</h4>
                    <ul>
                        <li>‚è±Ô∏è <strong>2 minutes</strong> per question</li>
                        <li>üéØ Read carefully - ¬°Lee con cuidado!</li>
                        <li>üí° Hover over <span class="translatable" style="border-bottom: 1px dotted #666;">Spanish words<span class="translation">palabras en espa√±ol</span></span> for translations</li>
                        <li>üìù Show your work mentally before selecting!</li>
                    </ul>
                </div>

                <button class="btn btn-primary" onclick="startQuiz()">¬°Comenzar! / Start Quiz</button>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quizScreen" style="display: none;">
            <div class="stats-bar">
                <div class="timer" id="timer">‚è±Ô∏è 2:00</div>
                <div class="progress" id="progress">Question 1 of 15</div>
                <div class="score" id="currentScore">Score: 0</div>
            </div>

            <div class="question-card" id="questionCard">
                <span class="category-badge" id="categoryBadge"></span>
                <div class="question-text" id="questionText"></div>
                <div class="options" id="optionsContainer"></div>
                <div class="feedback" id="feedback">
                    <h4 id="feedbackTitle"></h4>
                    <div class="explanation" id="feedbackExplanation"></div>
                </div>
                <div class="button-container">
                    <button class="btn btn-primary" id="submitBtn" onclick="submitAnswer()" disabled>
                        Submit Answer
                    </button>
                    <button class="btn btn-secondary" id="nextBtn" onclick="nextQuestion()" style="display: none;">
                        Next Question ‚Üí
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="results">
            <div class="results-card">
                <h2>üéâ Quiz Complete!</h2>
                
                <div class="score-circle" id="scoreCircle">
                    <div class="score-number" id="finalScore">0%</div>
                    <div class="score-label">Score</div>
                </div>

                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="correctCount">0</div>
                        <div class="stat-label">Correct ‚úÖ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="incorrectCount">0</div>
                        <div class="stat-label">Incorrect ‚ùå</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalTime">0:00</div>
                        <div class="stat-label">Total Time ‚è±Ô∏è</div>
                    </div>
                </div>

                <div class="category-breakdown" id="categoryBreakdown">
                    <h3>üìä Score by Topic</h3>
                </div>

                <div class="review-section" id="reviewSection" style="display: none;">
                    <h3>üìö Topics to Review</h3>
                    <ul id="reviewList"></ul>
                </div>

                <div class="button-container" style="margin-top: 30px;">
                    <button class="btn btn-primary" onclick="restartQuiz()">üîÑ Try Again</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Question Bank
        let questions = [
            // ORDERING DECIMALS
            {
                category: "Ordering Decimals",
                categoryClass: "category-ordering",
                question: `<span class="translatable">Escribe los n√∫meros<span class="translation">Write the numbers</span></span> en <span class="translatable">orden de menor a mayor<span class="translation">order from least to greatest</span></span>:<br><br><span class="decimal-display">1.5, 1.39, 1.15, 1.04</span>`,
                options: [
                    "1.04, 1.15, 1.39, 1.5",
                    "1.5, 1.39, 1.15, 1.04",
                    "1.04, 1.5, 1.15, 1.39",
                    "1.15, 1.04, 1.39, 1.5"
                ],
                correct: 0,
                explanation: `<strong>Steps:</strong>
                <div class="step">1. Compare the ones place: All have 1</div>
                <div class="step">2. Compare tenths: 0 < 1 < 3 < 5</div>
                <div class="step">3. So: 1.04 < 1.15 < 1.39 < 1.5 ‚úì</div>
                <p>üí° <strong>Tip:</strong> Add zeros to compare: 1.50, 1.39, 1.15, 1.04</p>`
            },
            {
                category: "Ordering Decimals",
                categoryClass: "category-ordering",
                question: `<span class="translatable">Ordena de menor a mayor<span class="translation">Order from least to greatest</span></span>:<br><br><span class="decimal-display">0.7, 0.07, 0.77, 0.17</span>`,
                options: [
                    "0.07, 0.17, 0.7, 0.77",
                    "0.7, 0.77, 0.07, 0.17",
                    "0.07, 0.7, 0.17, 0.77",
                    "0.17, 0.07, 0.7, 0.77"
                ],
                correct: 0,
                explanation: `<strong>Steps:</strong>
                <div class="step">1. Write with same decimal places: 0.07, 0.17, 0.70, 0.77</div>
                <div class="step">2. Now compare: 07 < 17 < 70 < 77</div>
                <div class="step">3. Answer: 0.07, 0.17, 0.7, 0.77 ‚úì</div>`
            },
            {
                category: "Ordering Decimals",
                categoryClass: "category-ordering",
                question: `<span class="translatable">Ordena las longitudes del hilo<span class="translation">Order the yarn lengths</span></span> de menor a mayor:<br><br><span class="decimal-display">0.2, 0.50, 0.65, 0.7</span>`,
                options: [
                    "0.2, 0.50, 0.65, 0.7",
                    "0.50, 0.2, 0.65, 0.7",
                    "0.2, 0.65, 0.50, 0.7",
                    "0.7, 0.65, 0.50, 0.2"
                ],
                correct: 0,
                explanation: `<strong>Steps:</strong>
                <div class="step">1. Convert to hundredths: 0.20, 0.50, 0.65, 0.70</div>
                <div class="step">2. Compare: 20 < 50 < 65 < 70</div>
                <div class="step">3. Answer: 0.2, 0.50, 0.65, 0.7 ‚úì</div>`
            },

            // MIXED FORMAT ORDERING (fractions, mixed numbers, decimals)
            {
                category: "Mixed Formats",
                categoryClass: "category-ordering",
                question: `<span class="translatable">Ordena de menor a mayor<span class="translation">Order from least to greatest</span></span>:<br><br>
                <span class="fraction"><span class="numerator">3</span><span class="denominator">10</span></span>, &nbsp;
                0.07, &nbsp;
                <span class="fraction"><span class="numerator">50</span><span class="denominator">100</span></span>, &nbsp;
                <span class="mixed-number">1<span class="fraction"><span class="numerator">5</span><span class="denominator">100</span></span></span>`,
                options: [
                    `0.07, <span class="fraction"><span class="numerator">3</span><span class="denominator">10</span></span>, <span class="fraction"><span class="numerator">50</span><span class="denominator">100</span></span>, <span class="mixed-number">1<span class="fraction"><span class="numerator">5</span><span class="denominator">100</span></span></span>`,
                    `<span class="fraction"><span class="numerator">3</span><span class="denominator">10</span></span>, 0.07, <span class="fraction"><span class="numerator">50</span><span class="denominator">100</span></span>, <span class="mixed-number">1<span class="fraction"><span class="numerator">5</span><span class="denominator">100</span></span></span>`,
                    `0.07, <span class="fraction"><span class="numerator">50</span><span class="denominator">100</span></span>, <span class="fraction"><span class="numerator">3</span><span class="denominator">10</span></span>, <span class="mixed-number">1<span class="fraction"><span class="numerator">5</span><span class="denominator">100</span></span></span>`,
                    `<span class="mixed-number">1<span class="fraction"><span class="numerator">5</span><span class="denominator">100</span></span></span>, <span class="fraction"><span class="numerator">50</span><span class="denominator">100</span></span>, <span class="fraction"><span class="numerator">3</span><span class="denominator">10</span></span>, 0.07`
                ],
                correct: 0,
                explanation: `<strong>Convert ALL to decimals first:</strong>
                <div class="step">3/10 = 0.30</div>
                <div class="step">0.07 = 0.07</div>
                <div class="step">50/100 = 0.50</div>
                <div class="step">1 5/100 = 1.05</div>
                <div class="step">Order: 0.07 < 0.30 < 0.50 < 1.05 ‚úì</div>
                <p>üí° Always convert to decimals to compare mixed formats!</p>`
            },
            {
                category: "Mixed Formats",
                categoryClass: "category-ordering",
                question: `<span class="translatable">Ordena de menor a mayor<span class="translation">Order from least to greatest</span></span>:<br><br>
                0.8, &nbsp;
                <span class="fraction"><span class="numerator">25</span><span class="denominator">100</span></span>, &nbsp;
                <span class="fraction"><span class="numerator">6</span><span class="denominator">10</span></span>, &nbsp;
                0.05`,
                options: [
                    `0.05, <span class="fraction"><span class="numerator">25</span><span class="denominator">100</span></span>, <span class="fraction"><span class="numerator">6</span><span class="denominator">10</span></span>, 0.8`,
                    `<span class="fraction"><span class="numerator">25</span><span class="denominator">100</span></span>, 0.05, <span class="fraction"><span class="numerator">6</span><span class="denominator">10</span></span>, 0.8`,
                    `0.05, <span class="fraction"><span class="numerator">6</span><span class="denominator">10</span></span>, <span class="fraction"><span class="numerator">25</span><span class="denominator">100</span></span>, 0.8`,
                    `0.8, <span class="fraction"><span class="numerator">6</span><span class="denominator">10</span></span>, <span class="fraction"><span class="numerator">25</span><span class="denominator">100</span></span>, 0.05`
                ],
                correct: 0,
                explanation: `<strong>Convert ALL to decimals:</strong>
                <div class="step">0.8 = 0.80</div>
                <div class="step">25/100 = 0.25</div>
                <div class="step">6/10 = 0.60</div>
                <div class="step">0.05 = 0.05</div>
                <div class="step">Order: 0.05 < 0.25 < 0.60 < 0.80 ‚úì</div>`
            },

            // COMPARING DECIMALS
            {
                category: "Comparing Decimals",
                categoryClass: "category-comparing",
                question: `¬ø<span class="translatable">Qu√© decimal es el mayor<span class="translation">Which decimal is the greatest</span></span>?`,
                options: [
                    `0.04 (4 <span class="translatable">cent√©simos<span class="translation">hundredths</span></span>)`,
                    `0.4 (4 <span class="translatable">d√©cimos<span class="translation">tenths</span></span>)`,
                    `0.41 (41 <span class="translatable">cent√©simos<span class="translation">hundredths</span></span>)`,
                    `0.14 (14 <span class="translatable">cent√©simos<span class="translation">hundredths</span></span>)`
                ],
                correct: 2,
                explanation: `<strong>Steps:</strong>
                <div class="step">1. Add zeros: 0.04, 0.40, 0.41, 0.14</div>
                <div class="step">2. Compare: 4, 40, 41, 14</div>
                <div class="step">3. Largest is 41, so 0.41 is greatest ‚úì</div>
                <p>üí° <strong>Remember:</strong> 0.4 = 0.40 (4 tenths = 40 hundredths)</p>`
            },
            {
                category: "Comparing Decimals",
                categoryClass: "category-comparing",
                question: `<span class="translatable">Compara<span class="translation">Compare</span></span>: 0.43 <span class="translatable">libras de naranjas<span class="translation">pounds of oranges</span></span> y 0.7 <span class="translatable">libras de peras<span class="translation">pounds of pears</span></span>.<br><br>0.43 ___ 0.7`,
                options: [
                    "0.43 > 0.7",
                    "0.43 < 0.7",
                    "0.43 = 0.7"
                ],
                correct: 1,
                explanation: `<strong>Steps:</strong>
                <div class="step">1. Convert 0.7 to hundredths: 0.7 = 0.70</div>
                <div class="step">2. Compare: 0.43 vs 0.70</div>
                <div class="step">3. 43 < 70, so 0.43 < 0.7 ‚úì</div>
                <p>üçä Oranges (0.43 lb) weigh LESS than pears (0.7 lb)</p>`
            },
            {
                category: "Comparing Decimals",
                categoryClass: "category-comparing",
                question: `<span class="translatable">Compara las longitudes del hilo<span class="translation">Compare the yarn lengths</span></span>:<br><br>1.4 metros ___ 1<span class="fraction"><span class="numerator">4</span><span class="denominator">100</span></span> metros`,
                options: [
                    "1.4 > 1.04",
                    "1.4 < 1.04",
                    "1.4 = 1.04"
                ],
                correct: 0,
                explanation: `<strong>Steps:</strong>
                <div class="step">1. Convert fraction: 1 4/100 = 1.04</div>
                <div class="step">2. Compare: 1.4 vs 1.04</div>
                <div class="step">3. 1.40 > 1.04 ‚úì</div>
                <p>üí° 1.4 meters is longer than 1.04 meters!</p>`
            },
            {
                category: "Comparing Decimals",
                categoryClass: "category-comparing",
                question: `¬ø<span class="translatable">Cu√°l es mayor<span class="translation">Which is greater</span></span>?<br><br>0.8 ___ 0.08`,
                options: [
                    "0.8 < 0.08",
                    "0.8 > 0.08",
                    "0.8 = 0.08"
                ],
                correct: 1,
                explanation: `<strong>Steps:</strong>
                <div class="step">1. 0.8 = 8 tenths = 80 hundredths</div>
                <div class="step">2. 0.08 = 8 hundredths</div>
                <div class="step">3. 80 > 8, so 0.8 > 0.08 ‚úì</div>
                <p>üí∞ Think money: $0.80 (80¬¢) vs $0.08 (8¬¢)</p>`
            },

            // CONVERTING - Fraction to Decimal
            {
                category: "Converting",
                categoryClass: "category-converting",
                question: `¬ø<span class="translatable">Cu√°l decimal es equivalente a<span class="translation">Which decimal is equivalent to</span></span> <span class="fraction"><span class="numerator">6</span><span class="denominator">10</span></span>?`,
                options: [
                    `0.06 (6 <span class="translatable">cent√©simos<span class="translation">hundredths</span></span>)`,
                    `0.60 (6 <span class="translatable">d√©cimos<span class="translation">tenths</span></span>)`,
                    "0.610",
                    "6.10"
                ],
                correct: 1,
                explanation: `<strong>Converting 6/10 to decimal:</strong>
                <div class="step">6 √∑ 10 = 0.6 = 0.60 ‚úì</div>
                <p>üí° /10 means tenths place (first spot after decimal)</p>
                <p>‚ùå 0.06 = 6/100 (hundredths - wrong!)</p>`
            },
            {
                category: "Converting",
                categoryClass: "category-converting",
                question: `<span class="translatable">Convierte<span class="translation">Convert</span></span> <span class="fraction"><span class="numerator">2</span><span class="denominator">10</span></span> <span class="translatable">a decimal<span class="translation">to decimal</span></span>:`,
                options: [
                    `0.02 (2 <span class="translatable">cent√©simos<span class="translation">hundredths</span></span>)`,
                    `0.2 (2 <span class="translatable">d√©cimos<span class="translation">tenths</span></span>)`,
                    "2.0",
                    `0.20 (20 <span class="translatable">cent√©simos<span class="translation">hundredths</span></span>)`
                ],
                correct: 1,
                explanation: `<strong>Converting 2/10:</strong>
                <div class="step">2/10 = 2 tenths = 0.2 ‚úì</div>
                <p>Note: 0.2 and 0.20 are equal, but 0.2 is simplest form!</p>`
            },
            {
                category: "Converting",
                categoryClass: "category-converting",
                question: `<span class="translatable">Convierte<span class="translation">Convert</span></span> <span class="fraction"><span class="numerator">50</span><span class="denominator">100</span></span> <span class="translatable">a decimal<span class="translation">to decimal</span></span>:`,
                options: [
                    `0.05 (5 <span class="translatable">cent√©simos<span class="translation">hundredths</span></span>)`,
                    `0.50 (50 <span class="translatable">cent√©simos<span class="translation">hundredths</span></span>)`,
                    "5.0",
                    "50.0"
                ],
                correct: 1,
                explanation: `<strong>Converting 50/100:</strong>
                <div class="step">50/100 = 50 hundredths = 0.50 ‚úì</div>
                <p>üí∞ Think: 50 cents = $0.50</p>`
            },
            {
                category: "Converting",
                categoryClass: "category-converting",
                question: `<span class="translatable">Convierte<span class="translation">Convert</span></span> <span class="fraction"><span class="numerator">7</span><span class="denominator">10</span></span> <span class="translatable">a decimal<span class="translation">to decimal</span></span>:`,
                options: [
                    `0.07 (7 <span class="translatable">cent√©simos<span class="translation">hundredths</span></span>)`,
                    `0.7 (7 <span class="translatable">d√©cimos<span class="translation">tenths</span></span>)`,
                    "7.0",
                    `0.70 (70 <span class="translatable">cent√©simos<span class="translation">hundredths</span></span>)`
                ],
                correct: 1,
                explanation: `<strong>Converting 7/10:</strong>
                <div class="step">7/10 = 7 tenths = 0.7 ‚úì</div>
                <p>üí∞ Think: 7 dimes = $0.70</p>`
            },

            // CONVERTING - Decimal to Fraction
            {
                category: "Converting",
                categoryClass: "category-converting",
                question: `¬ø<span class="translatable">Qu√© fracci√≥n equivale a<span class="translation">What fraction equals</span></span> .19?`,
                options: [
                    `<span class="fraction"><span class="numerator">1</span><span class="denominator">19</span></span>`,
                    `<span class="fraction"><span class="numerator">19</span><span class="denominator">100</span></span>`,
                    `<span class="mixed-number">1<span class="fraction"><span class="numerator">9</span><span class="denominator">10</span></span></span>`,
                    `<span class="fraction"><span class="numerator">19</span><span class="denominator">10</span></span>`
                ],
                correct: 1,
                explanation: `<strong>Converting 0.19:</strong>
                <div class="step">0.19 = 19 hundredths = 19/100 ‚úì</div>
                <p>üí° Two decimal places = hundredths (/100)</p>`
            },
            {
                category: "Converting",
                categoryClass: "category-converting",
                question: `Emerson <span class="translatable">comi√≥ un poco de una sand√≠a<span class="translation">ate some watermelon</span></span>. <span class="translatable">Quedaron cuatro d√©cimas partes<span class="translation">Four tenths remained</span></span>. ¬ø<span class="translatable">Qu√© fracci√≥n se comi√≥<span class="translation">What fraction was eaten</span></span>?`,
                options: [
                    `<span class="fraction"><span class="numerator">4</span><span class="denominator">10</span></span> = 0.4`,
                    `<span class="fraction"><span class="numerator">6</span><span class="denominator">10</span></span> = 0.6`,
                    `<span class="fraction"><span class="numerator">10</span><span class="denominator">4</span></span> = 2.5`,
                    `<span class="fraction"><span class="numerator">1</span><span class="denominator">4</span></span> = 0.25`
                ],
                correct: 1,
                explanation: `<strong>Solving:</strong>
                <div class="step">Whole watermelon = 10/10 = 1</div>
                <div class="step">Remaining = 4/10</div>
                <div class="step">Eaten = 10/10 - 4/10 = 6/10 = 0.6 ‚úì</div>
                <p>üçâ If 4/10 is left, then 6/10 was eaten!</p>`
            },

            // ADDING FRACTIONS
            {
                category: "Adding Fractions",
                categoryClass: "category-adding",
                question: `Benjam√≠n <span class="translatable">monta su patineta<span class="translation">rides his skateboard</span></span> <span class="fraction"><span class="numerator">7</span><span class="denominator">10</span></span> <span class="translatable">milla<span class="translation">mile</span></span> y luego <span class="fraction"><span class="numerator">26</span><span class="denominator">100</span></span> <span class="translatable">milla<span class="translation">mile</span></span>. ¬ø<span class="translatable">Cu√°nto patin√≥ en total<span class="translation">How far did he skate in total</span></span>?`,
                options: [
                    `<span class="fraction"><span class="numerator">33</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">96</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">33</span><span class="denominator">110</span></span>`,
                    `<span class="fraction"><span class="numerator">76</span><span class="denominator">100</span></span>`
                ],
                correct: 1,
                explanation: `<strong>Steps - Same Denominator First!</strong>
                <div class="step">7/10 = 70/100 (multiply by 10)</div>
                <div class="step">70/100 + 26/100 = 96/100 ‚úì</div>
                <p>üõπ Benjamin skated 96/100 mile total!</p>`
            },
            {
                category: "Adding Fractions",
                categoryClass: "category-adding",
                type: "select-all",
                question: `<span class="fraction"><span class="numerator">9</span><span class="denominator">10</span></span> + <span class="fraction"><span class="numerator">50</span><span class="denominator">100</span></span> = ?<br><br>üîò <span class="translatable">Selecciona TODAS las respuestas correctas<span class="translation">Select ALL correct answers</span></span> (3):`,
                options: [
                    `<span class="mixed-number">1<span class="fraction"><span class="numerator">40</span><span class="denominator">100</span></span></span>`,
                    `<span class="fraction"><span class="numerator">59</span><span class="denominator">110</span></span>`,
                    `<span class="fraction"><span class="numerator">140</span><span class="denominator">100</span></span>`,
                    `<span class="mixed-number">1<span class="fraction"><span class="numerator">4</span><span class="denominator">10</span></span></span>`,
                    `<span class="fraction"><span class="numerator">59</span><span class="denominator">100</span></span>`
                ],
                correct: [0, 2, 3],
                explanation: `<strong>Steps:</strong>
                <div class="step">9/10 = 90/100</div>
                <div class="step">90/100 + 50/100 = 140/100 ‚úì</div>
                <div class="step">140/100 = 1 40/100 = 1 4/10 ‚úì</div>
                <p>All THREE are equivalent! 140/100 = 1 40/100 = 1 4/10</p>
                <p>‚ö†Ô∏è NOT 59/100 or 59/110 (don't add denominators!)</p>`
            },
            {
                category: "Adding Fractions",
                categoryClass: "category-adding",
                question: `<span class="fraction"><span class="numerator">3</span><span class="denominator">10</span></span> + <span class="fraction"><span class="numerator">45</span><span class="denominator">100</span></span> = ?`,
                options: [
                    `<span class="fraction"><span class="numerator">48</span><span class="denominator">110</span></span>`,
                    `<span class="fraction"><span class="numerator">48</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">75</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">345</span><span class="denominator">100</span></span>`
                ],
                correct: 2,
                explanation: `<strong>Steps - Get Same Denominator!</strong>
                <div class="step">3/10 = 30/100 ‚Üê Add zero!</div>
                <div class="step">30/100 + 45/100 = 75/100 ‚úì</div>
                <p>‚ùå Never add the denominators (10 + 100 ‚â† 110)</p>`
            },
            {
                category: "Adding Fractions",
                categoryClass: "category-adding",
                question: `<span class="fraction"><span class="numerator">5</span><span class="denominator">10</span></span> + <span class="fraction"><span class="numerator">38</span><span class="denominator">100</span></span> = ?`,
                options: [
                    `<span class="fraction"><span class="numerator">43</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">88</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">43</span><span class="denominator">110</span></span>`,
                    `<span class="fraction"><span class="numerator">538</span><span class="denominator">100</span></span>`
                ],
                correct: 1,
                explanation: `<strong>Steps:</strong>
                <div class="step">5/10 = 50/100</div>
                <div class="step">50/100 + 38/100 = 88/100 ‚úì</div>
                <p>üí° Remember: 5/10 = 50/100, not just 5!</p>`
            },
            {
                category: "Adding Fractions",
                categoryClass: "category-adding",
                question: `<span class="fraction"><span class="numerator">4</span><span class="denominator">100</span></span> + <span class="fraction"><span class="numerator">8</span><span class="denominator">10</span></span> = ?`,
                options: [
                    `<span class="fraction"><span class="numerator">12</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">12</span><span class="denominator">110</span></span>`,
                    `<span class="fraction"><span class="numerator">84</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">48</span><span class="denominator">100</span></span>`
                ],
                correct: 2,
                explanation: `<strong>Steps:</strong>
                <div class="step">8/10 = 80/100 ‚Üê Convert!</div>
                <div class="step">4/100 + 80/100 = 84/100 ‚úì</div>
                <p>‚ùå NOT 12/100 (that's adding without converting)</p>`
            },

            // INTERACTIVE NUMBER LINE - Click to place (keeping one static example)
            {
                category: "Number Line",
                categoryClass: "category-comparing",
                type: "interactive-numberline",
                targetValue: 0.35,
                tolerance: 0.05,
                question: `üëÜ <span class="translatable">Haz clic en la recta num√©rica para colocar<span class="translation">Click on the number line to place</span></span> <strong>0.35</strong>
                <div class="number-line-interactive" id="interactiveNumberLine" onclick="placePoint(event)">
                    <div class="number-line-track"></div>
                    <div class="number-line-tick major" style="left: 0%;"></div>
                    <div class="number-line-label" style="left: 0%;">0</div>
                    <div class="number-line-tick" style="left: 10%;"></div>
                    <div class="number-line-tick" style="left: 20%;"></div>
                    <div class="number-line-tick" style="left: 30%;"></div>
                    <div class="number-line-tick" style="left: 40%;"></div>
                    <div class="number-line-tick major" style="left: 50%;"></div>
                    <div class="number-line-label" style="left: 50%;">0.5</div>
                    <div class="number-line-tick" style="left: 60%;"></div>
                    <div class="number-line-tick" style="left: 70%;"></div>
                    <div class="number-line-tick" style="left: 80%;"></div>
                    <div class="number-line-tick" style="left: 90%;"></div>
                    <div class="number-line-tick major" style="left: 100%;"></div>
                    <div class="number-line-label" style="left: 100%;">1</div>
                    <div class="user-point" id="userPoint"></div>
                </div>
                <p class="click-hint">üëÜ Click where 0.35 should go!</p>`,
                options: [],
                correct: null,
                explanation: `<strong>Placing 0.35:</strong>
                <div class="step">0.35 is between 0.3 and 0.4</div>
                <div class="step">It's a little past the 0.3 mark</div>
                <div class="step">About 35% of the way from 0 to 1 ‚úì</div>`
            },

            // NUMBER LINE QUESTIONS (static examples - dynamic ones added at quiz start)
            {
                category: "Number Line",
                categoryClass: "category-comparing",
                question: `<span class="translatable">Mira la recta num√©rica<span class="translation">Look at the number line</span></span>. ¬ø<span class="translatable">Cu√°l es mayor<span class="translation">Which is greater</span></span>?
                <div class="number-line">
                    <div class="number-line-track"></div>
                    <div class="number-line-tick major" style="left: 0%;"></div>
                    <div class="number-line-label" style="left: 0%;">0</div>
                    <div class="number-line-tick" style="left: 10%;"></div>
                    <div class="number-line-tick" style="left: 20%;"></div>
                    <div class="number-line-tick" style="left: 30%;"></div>
                    <div class="number-line-tick" style="left: 40%;"></div>
                    <div class="number-line-tick major" style="left: 50%;"></div>
                    <div class="number-line-label" style="left: 50%;">0.5</div>
                    <div class="number-line-tick" style="left: 60%;"></div>
                    <div class="number-line-tick" style="left: 70%;"></div>
                    <div class="number-line-tick" style="left: 80%;"></div>
                    <div class="number-line-tick" style="left: 90%;"></div>
                    <div class="number-line-tick major" style="left: 100%;"></div>
                    <div class="number-line-label" style="left: 100%;">1</div>
                    <div class="number-line-point" style="left: 43%;"><span class="point-label">0.43</span></div>
                    <div class="number-line-point blue" style="left: 70%;"><span class="point-label">0.7</span></div>
                </div>`,
                options: [
                    "0.43 > 0.7",
                    "0.43 < 0.7",
                    "0.43 = 0.7"
                ],
                correct: 1,
                explanation: `<strong>Using the Number Line:</strong>
                <div class="step">0.43 is LEFT of 0.7 on the number line</div>
                <div class="step">LEFT = smaller, RIGHT = bigger</div>
                <div class="step">So 0.43 < 0.7 ‚úì</div>
                <p>üí° On a number line, numbers get BIGGER as you go RIGHT!</p>`
            },
            {
                category: "Number Line",
                categoryClass: "category-comparing",
                question: `<span class="translatable">Usa la recta num√©rica<span class="translation">Use the number line</span></span>. ¬ø<span class="translatable">D√≥nde est√°<span class="translation">Where is</span></span> 0.35?
                <div class="number-line">
                    <div class="number-line-track"></div>
                    <div class="number-line-tick major" style="left: 0%;"></div>
                    <div class="number-line-label" style="left: 0%;">0</div>
                    <div class="number-line-tick" style="left: 10%;"></div>
                    <div class="number-line-label" style="left: 10%;">A</div>
                    <div class="number-line-tick" style="left: 20%;"></div>
                    <div class="number-line-tick" style="left: 30%;"></div>
                    <div class="number-line-tick" style="left: 35%;"></div>
                    <div class="number-line-label" style="left: 35%;">B</div>
                    <div class="number-line-tick" style="left: 40%;"></div>
                    <div class="number-line-tick major" style="left: 50%;"></div>
                    <div class="number-line-label" style="left: 50%;">0.5</div>
                    <div class="number-line-tick" style="left: 60%;"></div>
                    <div class="number-line-tick" style="left: 65%;"></div>
                    <div class="number-line-label" style="left: 65%;">C</div>
                    <div class="number-line-tick" style="left: 70%;"></div>
                    <div class="number-line-tick" style="left: 80%;"></div>
                    <div class="number-line-tick" style="left: 90%;"></div>
                    <div class="number-line-label" style="left: 90%;">D</div>
                    <div class="number-line-tick major" style="left: 100%;"></div>
                    <div class="number-line-label" style="left: 100%;">1</div>
                </div>`,
                options: [
                    "A (0.10)",
                    "B (0.35)",
                    "C (0.65)",
                    "D (0.90)"
                ],
                correct: 1,
                explanation: `<strong>Finding 0.35:</strong>
                <div class="step">0.35 is between 0 and 0.5</div>
                <div class="step">It's a little more than 1/3 of the way</div>
                <div class="step">Point B at 0.35 is correct! ‚úì</div>`
            },
            {
                category: "Number Line",
                categoryClass: "category-comparing",
                type: "place-two-points",
                point1: { value: 0.8, label: "0.8" },
                point2: { value: 0.08, label: "0.08" },
                question: `üëÜ <span class="translatable">Coloca los dos n√∫meros en la recta num√©rica<span class="translation">Place both numbers on the number line</span></span>, <span class="translatable">luego compara<span class="translation">then compare</span></span>:
                <div class="number-line-interactive" id="twoPointNumberLine" style="height: 100px;">
                    <div class="number-line-track"></div>
                    <div class="number-line-tick major" style="left: 0%;"></div>
                    <div class="number-line-label" style="left: 0%;">0</div>
                    <div class="number-line-tick" style="left: 10%;"></div>
                    <div class="number-line-tick" style="left: 20%;"></div>
                    <div class="number-line-tick" style="left: 30%;"></div>
                    <div class="number-line-tick" style="left: 40%;"></div>
                    <div class="number-line-tick major" style="left: 50%;"></div>
                    <div class="number-line-label" style="left: 50%;">0.5</div>
                    <div class="number-line-tick" style="left: 60%;"></div>
                    <div class="number-line-tick" style="left: 70%;"></div>
                    <div class="number-line-tick" style="left: 80%;"></div>
                    <div class="number-line-tick" style="left: 90%;"></div>
                    <div class="number-line-tick major" style="left: 100%;"></div>
                    <div class="number-line-label" style="left: 100%;">1</div>
                </div>
                <div style="text-align: center; margin: 10px 0;">
                    <button class="point-btn" id="placePoint1Btn" onclick="selectPointToPlace(1)" style="background: #e91e63; color: white; border: none; padding: 8px 16px; border-radius: 20px; margin: 5px; cursor: pointer;">üìç Place 0.8</button>
                    <button class="point-btn" id="placePoint2Btn" onclick="selectPointToPlace(2)" style="background: #2196F3; color: white; border: none; padding: 8px 16px; border-radius: 20px; margin: 5px; cursor: pointer;">üìç Place 0.08</button>
                </div>
                <p style="text-align: center; color: #666; font-size: 0.85rem;" id="placeHint">Click a button, then click the number line!</p>
                <br>0.8 ___ 0.08`,
                options: [
                    "0.8 < 0.08",
                    "0.8 > 0.08",
                    "0.8 = 0.08"
                ],
                correct: 1,
                explanation: `<strong>Look at the positions!</strong>
                <div class="step">0.8 is FAR to the right (80%)</div>
                <div class="step">0.08 is very close to 0 (only 8%)</div>
                <div class="step">0.8 > 0.08 ‚úì</div>
                <p>üí∞ Think money: $0.80 vs $0.08 - which is more?</p>`
            },

            // DECIMAL GRID QUESTIONS
            {
                category: "Decimal Grids",
                categoryClass: "category-converting",
                type: "select-all",
                question: `¬ø<span class="translatable">Qu√© decimal representa esta cuadr√≠cula<span class="translation">What decimal does this grid represent</span></span>?
                <div class="decimal-grid-container">
                    <div>
                        <div class="decimal-grid" id="grid1">
                            ${Array(100).fill(0).map((_, i) => `<div class="cell ${i < 60 ? 'shaded' : ''}"></div>`).join('')}
                        </div>
                        <div class="grid-label">?</div>
                    </div>
                </div>
                <br>üîò <span class="translatable">Selecciona TODAS las respuestas correctas<span class="translation">Select ALL correct answers</span></span>:`,
                options: [
                    "0.06",
                    "0.6",
                    "6.0",
                    "0.60"
                ],
                correct: [1, 3],
                explanation: `<strong>Reading the Grid:</strong>
                <div class="step">The grid has 100 squares total</div>
                <div class="step">60 squares are shaded</div>
                <div class="step">60/100 = 0.60 = 0.6 ‚úì</div>
                <p>üí° BOTH 0.6 and 0.60 are correct! They're the same number!</p>`
            },
            {
                category: "Decimal Grids",
                categoryClass: "category-converting",
                type: "interactive-grid",
                targetShaded: 70,
                question: `üëÜ <span class="translatable">Sombrea la cuadr√≠cula para mostrar<span class="translation">Shade the grid to show</span></span> <span class="fraction"><span class="numerator">7</span><span class="denominator">10</span></span>:
                <div class="decimal-grid-container">
                    <div>
                        <div class="decimal-grid-interactive" id="interactiveGrid"></div>
                        <div class="shade-counter"><span id="shadedCount">0</span>/100 <span class="translatable">sombreados<span class="translation">shaded</span></span></div>
                    </div>
                </div>
                <p style="text-align: center; color: #666; font-size: 0.85rem;">üí° 7/10 = ?/100 - Click to shade!</p>`,
                options: [],
                correct: null,
                explanation: `<strong>Converting 7/10 to hundredths:</strong>
                <div class="step">7/10 = 70/100</div>
                <div class="step">So shade 70 out of 100 squares ‚úì</div>
                <p>üí° To convert /10 to /100, multiply by 10!</p>`
            },
            {
                category: "Decimal Grids",
                categoryClass: "category-adding",
                type: "interactive-dual-grid",
                grid1Target: 70,
                grid2Target: 26,
                question: `üëÜ <span class="translatable">Sombrea las cuadr√≠culas para mostrar tu trabajo<span class="translation">Shade the grids to show your work</span></span>:<br><br>
                <span class="fraction"><span class="numerator">7</span><span class="denominator">10</span></span> + <span class="fraction"><span class="numerator">26</span><span class="denominator">100</span></span> = ?
                <div class="decimal-grid-container">
                    <div>
                        <div class="decimal-grid-interactive" id="interactiveGrid1"></div>
                        <div class="grid-label"><span class="fraction"><span class="numerator">7</span><span class="denominator">10</span></span> = <span id="grid1Count">0</span>/100</div>
                    </div>
                    <div style="display: flex; align-items: center; font-size: 2rem; color: #333;">+</div>
                    <div>
                        <div class="decimal-grid-interactive grid-blue" id="interactiveGrid2"></div>
                        <div class="grid-label"><span class="fraction"><span class="numerator">26</span><span class="denominator">100</span></span> = <span id="grid2Count">0</span>/100</div>
                    </div>
                </div>
                <p style="text-align: center; color: #666; font-size: 0.85rem;">üé® <span class="translatable">Sombrea y calcula<span class="translation">Shade and calculate</span></span>: 7/10 + 26/100 = ?</p>`,
                options: [
                    `<span class="fraction"><span class="numerator">33</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">96</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">33</span><span class="denominator">110</span></span>`,
                    `<span class="fraction"><span class="numerator">726</span><span class="denominator">100</span></span>`
                ],
                correct: 1,
                explanation: `<strong>Adding with Grids:</strong>
                <div class="step">Green: 7/10 = 70/100 (70 squares)</div>
                <div class="step">Blue: 26/100 (26 squares)</div>
                <div class="step">Total: 70 + 26 = 96 squares = 96/100 ‚úì</div>
                <p>üõπ This is the skateboard problem from your study guide!</p>`
            },

            // MIXED FRACTION TO DECIMAL
            {
                category: "Converting",
                categoryClass: "category-converting",
                question: `<span class="translatable">Convierte<span class="translation">Convert</span></span> <span class="mixed-number">1<span class="fraction"><span class="numerator">4</span><span class="denominator">100</span></span></span> <span class="translatable">a decimal<span class="translation">to decimal</span></span>:`,
                options: [
                    "1.04",
                    "1.4",
                    "1.40",
                    "0.14"
                ],
                correct: 0,
                explanation: `<strong>Converting Mixed Fractions:</strong>
                <div class="step">1 4/100 = 1 + 4/100</div>
                <div class="step">4/100 = 0.04</div>
                <div class="step">1 + 0.04 = 1.04 ‚úì</div>
                <p>üí° The whole number stays, then add the fraction as a decimal!</p>`
            },
            {
                category: "Converting",
                categoryClass: "category-converting",
                question: `<span class="translatable">Convierte<span class="translation">Convert</span></span> <span class="mixed-number">2<span class="fraction"><span class="numerator">35</span><span class="denominator">100</span></span></span> <span class="translatable">a decimal<span class="translation">to decimal</span></span>:`,
                options: [
                    "2.35",
                    "2.035",
                    "23.5",
                    "0.235"
                ],
                correct: 0,
                explanation: `<strong>Converting Mixed Fractions:</strong>
                <div class="step">2 35/100 = 2 + 35/100</div>
                <div class="step">35/100 = 0.35</div>
                <div class="step">2 + 0.35 = 2.35 ‚úì</div>`
            },

            // DECIMAL REPRESENTATION
            {
                category: "Converting",
                categoryClass: "category-converting",
                question: `<span class="translatable">Seis d√©cimos<span class="translation">Six tenths</span></span> = ?<br><br><span class="translatable">Escribe como fracci√≥n Y decimal<span class="translation">Write as fraction AND decimal</span></span>:`,
                options: [
                    `<span class="fraction"><span class="numerator">6</span><span class="denominator">10</span></span> = 0.6`,
                    `<span class="fraction"><span class="numerator">6</span><span class="denominator">100</span></span> = 0.06`,
                    `<span class="fraction"><span class="numerator">60</span><span class="denominator">10</span></span> = 6.0`,
                    `<span class="fraction"><span class="numerator">16</span><span class="denominator">10</span></span> = 1.6`
                ],
                correct: 0,
                explanation: `<strong>"Seis d√©cimos" = Six tenths:</strong>
                <div class="step">D√©cimos = tenths = /10</div>
                <div class="step">6/10 = 0.6 ‚úì</div>
                <p>üí° "D√©cimos" = tenths (10), "Cent√©simos" = hundredths (100)</p>`
            }
        ];

        // Quiz State
        let currentQuestion = 0;
        let score = 0;
        let selectedAnswers = [];  // Changed to array for multi-select support
        let timer = null;
        let timeLeft = 120;
        let totalTimeUsed = 0;
        let shuffledQuestions = [];
        let categoryScores = {};
        let answered = false;

        // ==========================================
        // DYNAMIC QUESTION GENERATORS
        // ==========================================
        
        // ==========================================
        // STUDY GUIDE FORMAT QUESTION GENERATORS
        // (Exact formats from study guide, random numbers)
        // ==========================================

        // Q1 FORMAT: Mrs. Tallman wrote these four numbers - order them
        function generateOrderingQuestion() {
            // Generate 4 random decimals like study guide (1.x format)
            const base = Math.floor(Math.random() * 2); // 0 or 1
            const decimals = [
                (base + Math.random() * 0.6 + 0.01).toFixed(2),
                (base + Math.random() * 0.6 + 0.1).toFixed(2),
                (base + Math.random() * 0.6 + 0.3).toFixed(2),
                (base + Math.random() * 0.6 + 0.5).toFixed(2)
            ];
            
            // Shuffle the display order
            const shuffledDisplay = shuffle([...decimals]);
            const sorted = [...shuffledDisplay].sort((a, b) => parseFloat(a) - parseFloat(b));
            const reverseSorted = [...sorted].reverse();
            const wrong1 = shuffle([...shuffledDisplay]);
            const wrong2 = shuffle([...shuffledDisplay]);
            
            return {
                category: "Ordering Decimals",
                categoryClass: "category-ordering",
                question: `La <span class="translatable">maestra<span class="translation">teacher</span></span> <span class="translatable">escribi√≥ estos n√∫meros en la pizarra<span class="translation">wrote these numbers on the board</span></span>:<br><br><span class="decimal-display">${shuffledDisplay.join(', ')}</span><br><br><span class="translatable">Ordena de menor a mayor<span class="translation">Order from least to greatest</span></span>:`,
                options: [
                    sorted.join(', '),
                    reverseSorted.join(', '),
                    wrong1.join(', '),
                    wrong2.join(', ')
                ],
                correct: 0,
                explanation: `<strong>Steps:</strong>
                <div class="step">1. Compare the ones place first</div>
                <div class="step">2. Then compare tenths, then hundredths</div>
                <div class="step">3. Order: ${sorted.join(' < ')} ‚úì</div>`,
                isDynamic: true
            };
        }

        // Q2 FORMAT: Which decimal is greatest?
        function generateWhichIsGreatestQuestion() {
            const options = [
                (Math.random() * 0.09 + 0.01).toFixed(2),  // 0.0x
                (Math.random() * 0.4 + 0.3).toFixed(1),    // 0.x
                (Math.random() * 0.4 + 0.4).toFixed(2),    // 0.xx (largest)
                (Math.random() * 0.2 + 0.1).toFixed(2)     // 0.1x
            ];
            
            // Find the actual greatest
            let maxIdx = 0;
            let maxVal = parseFloat(options[0]);
            options.forEach((opt, idx) => {
                if (parseFloat(opt) > maxVal) {
                    maxVal = parseFloat(opt);
                    maxIdx = idx;
                }
            });
            
            return {
                category: "Comparing Decimals",
                categoryClass: "category-comparing",
                question: `¬ø<span class="translatable">Qu√© decimal es el mayor<span class="translation">Which decimal is the greatest</span></span>?`,
                options: options,
                correct: maxIdx,
                explanation: `<strong>Finding the Greatest:</strong>
                <div class="step">Convert to same places: ${options.map(o => parseFloat(o).toFixed(2)).join(', ')}</div>
                <div class="step">Greatest: ${options[maxIdx]} ‚úì</div>`,
                isDynamic: true
            };
        }

        // Q3 FORMAT: Benjamin skateboard problem
        function generateAddingFractions() {
            const num1 = Math.floor(Math.random() * 8) + 1;  // 1-8 for /10
            const num2 = Math.floor(Math.random() * 80) + 10; // 10-89 for /100
            const correctAnswer = (num1 * 10) + num2;
            
            const activities = [
                ['monta su patineta', 'rides his skateboard', 'patin√≥', 'skate'],
                ['camina', 'walks', 'camin√≥', 'walk'],
                ['corre', 'runs', 'corri√≥', 'run'],
                ['nada', 'swims', 'nad√≥', 'swim']
            ];
            const activity = activities[Math.floor(Math.random() * activities.length)];
            
            return {
                category: "Adding Fractions",
                categoryClass: "category-adding",
                question: `<span class="translatable">${activity[0]}<span class="translation">${activity[1]}</span></span> <span class="fraction"><span class="numerator">${num1}</span><span class="denominator">10</span></span> <span class="translatable">milla<span class="translation">mile</span></span> y luego <span class="fraction"><span class="numerator">${num2}</span><span class="denominator">100</span></span> <span class="translatable">milla m√°s<span class="translation">more mile</span></span>. ¬ø<span class="translatable">Cu√°nto ${activity[2]} en total<span class="translation">How far did they ${activity[3]} in total</span></span>?`,
                options: [
                    `<span class="fraction"><span class="numerator">${correctAnswer}</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">${num1 + num2}</span><span class="denominator">110</span></span>`,
                    `<span class="fraction"><span class="numerator">${num1 + num2}</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">${correctAnswer + 10}</span><span class="denominator">100</span></span>`
                ],
                correct: 0,
                explanation: `<strong>Steps:</strong>
                <div class="step">${num1}/10 = ${num1 * 10}/100</div>
                <div class="step">${num1 * 10}/100 + ${num2}/100 = ${correctAnswer}/100 ‚úì</div>
                <p>‚ö†Ô∏è Convert to same denominator first!</p>`,
                isDynamic: true
            };
        }

        // Q5 FORMAT: Watermelon problem (what fraction was eaten?)
        function generateWatermelonQuestion() {
            const remaining = Math.floor(Math.random() * 7) + 2; // 2-8 tenths remaining
            const eaten = 10 - remaining;
            
            const foods = [
                ['sand√≠a', 'watermelon', 'üçâ'],
                ['pizza', 'pizza', 'üçï'],
                ['pastel', 'cake', 'üéÇ'],
                ['pay', 'pie', 'ü•ß']
            ];
            const food = foods[Math.floor(Math.random() * foods.length)];
            
            return {
                category: "Converting",
                categoryClass: "category-converting",
                question: `${food[2]} <span class="translatable">Quedaron<span class="translation">There remained</span></span> <span class="fraction"><span class="numerator">${remaining}</span><span class="denominator">10</span></span> de la <span class="translatable">${food[0]}<span class="translation">${food[1]}</span></span>. ¬ø<span class="translatable">Qu√© fracci√≥n se comi√≥<span class="translation">What fraction was eaten</span></span>?`,
                options: [
                    `<span class="fraction"><span class="numerator">${eaten}</span><span class="denominator">10</span></span> = 0.${eaten}`,
                    `<span class="fraction"><span class="numerator">${remaining}</span><span class="denominator">10</span></span> = 0.${remaining}`,
                    `<span class="fraction"><span class="numerator">${eaten}</span><span class="denominator">100</span></span> = 0.0${eaten}`,
                    `<span class="fraction"><span class="numerator">1</span><span class="denominator">${remaining}</span></span>`
                ],
                correct: 0,
                explanation: `<strong>Solving:</strong>
                <div class="step">Whole ${food[1]} = 10/10 = 1</div>
                <div class="step">Remaining = ${remaining}/10</div>
                <div class="step">Eaten = 10/10 - ${remaining}/10 = ${eaten}/10 = 0.${eaten} ‚úì</div>`,
                isDynamic: true
            };
        }

        // Q8 FORMAT: What fraction equals .XX?
        function generateDecimalToFractionQuestion() {
            const num = Math.floor(Math.random() * 90) + 10; // 10-99
            const decimal = (num / 100).toFixed(2);
            
            return {
                category: "Converting",
                categoryClass: "category-converting",
                question: `¬ø<span class="translatable">Qu√© fracci√≥n equivale a<span class="translation">What fraction equals</span></span> ${decimal}?`,
                options: [
                    `<span class="fraction"><span class="numerator">${num}</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">1</span><span class="denominator">${num}</span></span>`,
                    `<span class="mixed-number">1<span class="fraction"><span class="numerator">${num % 10}</span><span class="denominator">10</span></span></span>`,
                    `<span class="fraction"><span class="numerator">${num}</span><span class="denominator">10</span></span>`
                ],
                correct: 0,
                explanation: `<strong>Converting ${decimal}:</strong>
                <div class="step">${decimal} = ${num} hundredths = ${num}/100 ‚úì</div>
                <p>üí° Two decimal places = hundredths (/100)</p>`,
                isDynamic: true
            };
        }

        // Q4 FORMAT: Compare weights with number line
        function generateComparingQuestion() {
            const a = (Math.random() * 0.5 + 0.2).toFixed(2);
            const b = (Math.random() * 0.5 + 0.4).toFixed(1);
            
            const items = [
                ['naranjas', 'oranges', 'peras', 'pears'],
                ['manzanas', 'apples', 'pl√°tanos', 'bananas'],
                ['zanahorias', 'carrots', 'papas', 'potatoes']
            ];
            const item = items[Math.floor(Math.random() * items.length)];
            
            let correct, symbol;
            if (parseFloat(a) < parseFloat(b)) {
                correct = 1;
                symbol = '<';
            } else if (parseFloat(a) > parseFloat(b)) {
                correct = 0;
                symbol = '>';
            } else {
                correct = 2;
                symbol = '=';
            }
            
            return {
                category: "Comparing Decimals",
                categoryClass: "category-comparing",
                question: `<span class="translatable">Compara<span class="translation">Compare</span></span>: ${a} <span class="translatable">libras de ${item[0]}<span class="translation">pounds of ${item[1]}</span></span> y ${b} <span class="translatable">libras de ${item[2]}<span class="translation">pounds of ${item[3]}</span></span>.<br><br>${a} ___ ${b}`,
                options: [
                    `${a} > ${b}`,
                    `${a} < ${b}`,
                    `${a} = ${b}`
                ],
                correct: correct,
                explanation: `<strong>Comparing:</strong>
                <div class="step">Convert to same places: ${parseFloat(a).toFixed(2)} vs ${parseFloat(b).toFixed(2)}</div>
                <div class="step">${a} ${symbol} ${b} ‚úì</div>`,
                isDynamic: true
            };
        }

        // Generate dynamic fill-in number line
        function generateFillNumberLine() {
            // Use 0-1 range with clear tenths
            const maxVal = 1;
            
            // Pick 3 positions that are easy multiples of 0.1 (10%, 20%, etc)
            const allPositions = [10, 20, 30, 40, 60, 70, 80, 90];
            const shuffledPos = shuffle([...allPositions]);
            const positions = [shuffledPos[0], shuffledPos[1], shuffledPos[2]].sort((a,b) => a - b);
            
            // Calculate actual values
            const values = positions.map(p => ((p / 100) * maxVal).toFixed(1));
            
            return {
                category: "Number Line",
                categoryClass: "category-comparing",
                type: "fill-numberline",
                answers: {
                    'input1': values[0],
                    'input2': values[1],
                    'input3': values[2]
                },
                question: `‚úèÔ∏è <span class="translatable">Escribe los decimales que faltan<span class="translation">Write the missing decimals</span></span>:
                <div class="numberline-fill" id="fillNumberLine">
                    <div class="track"></div>
                    <!-- 0 -->
                    <div class="tick major" style="left: 0%;"></div>
                    <div class="label-fixed" style="left: 0%;">0</div>
                    <!-- Small ticks for reference -->
                    <div class="tick" style="left: 10%;"></div>
                    <div class="tick" style="left: 20%;"></div>
                    <div class="tick" style="left: 30%;"></div>
                    <div class="tick" style="left: 40%;"></div>
                    <!-- 0.5 -->
                    <div class="tick major" style="left: 50%;"></div>
                    <div class="label-fixed" style="left: 50%;">0.5</div>
                    <!-- More small ticks -->
                    <div class="tick" style="left: 60%;"></div>
                    <div class="tick" style="left: 70%;"></div>
                    <div class="tick" style="left: 80%;"></div>
                    <div class="tick" style="left: 90%;"></div>
                    <!-- 1 -->
                    <div class="tick major" style="left: 100%;"></div>
                    <div class="label-fixed" style="left: 100%;">1</div>
                    
                    <!-- Input boxes at specific positions -->
                    <div class="arrow" style="left: ${positions[0]}%;">‚Üì</div>
                    <input type="text" class="label-input" id="input1" style="left: ${positions[0]}%;" placeholder="?" maxlength="4">
                    
                    <div class="arrow" style="left: ${positions[1]}%;">‚Üì</div>
                    <input type="text" class="label-input" id="input2" style="left: ${positions[1]}%;" placeholder="?" maxlength="4">
                    
                    <div class="arrow" style="left: ${positions[2]}%;">‚Üì</div>
                    <input type="text" class="label-input" id="input3" style="left: ${positions[2]}%;" placeholder="?" maxlength="4">
                </div>
                <p style="text-align: center; color: #666; font-size: 0.85rem;">üí° <span class="translatable">Cada marca peque√±a<span class="translation">Each small tick</span></span> = 0.1</p>`,
                options: [],
                correct: null,
                explanation: `<strong>Reading the Number Line:</strong>
                <div class="step">Range is 0 to 1, with 0.5 in the middle</div>
                <div class="step">Each small tick = 0.1 (one tenth)</div>
                <div class="step">First blank at ${positions[0]}% = ${values[0]} ‚úì</div>
                <div class="step">Second blank at ${positions[1]}% = ${values[1]} ‚úì</div>
                <div class="step">Third blank at ${positions[2]}% = ${values[2]} ‚úì</div>`,
                isDynamic: true
            };
        }

        // Generate dynamic interactive grid shading
        function generateInteractiveGrid() {
            // Random target: shade X/10 (so 10, 20, 30... 90 squares)
            const tenths = Math.floor(Math.random() * 8) + 2; // 2-9 tenths
            const targetShaded = tenths * 10;
            
            return {
                category: "Decimal Grids",
                categoryClass: "category-converting",
                type: "interactive-grid",
                targetShaded: targetShaded,
                question: `üé® <span class="translatable">Sombrea<span class="translation">Shade</span></span> <span class="fraction"><span class="numerator">${tenths}</span><span class="denominator">10</span></span>
                <div class="decimal-grid-container">
                    <div>
                        <div class="decimal-grid-interactive" id="interactiveGrid"></div>
                        <div class="shade-counter"><span id="shadedCount">0</span>/100 shaded</div>
                    </div>
                </div>
                <p style="text-align: center; color: #666; font-size: 0.85rem;">üí° Click & drag to shade faster!</p>`,
                options: [],
                correct: null,
                explanation: `<strong>Shading ${tenths}/10:</strong>
                <div class="step">${tenths}/10 = ${targetShaded}/100</div>
                <div class="step">Shade ${targetShaded} squares ‚úì</div>
                <p>üí° ${tenths} columns = ${targetShaded} squares!</p>`,
                isDynamic: true
            };
        }

        // Generate dynamic click-to-place number line
        function generateClickNumberLine() {
            // Random value between 0.1 and 0.9
            const targetValue = (Math.floor(Math.random() * 8) + 1) / 10 + (Math.floor(Math.random() * 9) + 1) / 100;
            const displayValue = targetValue.toFixed(2);
            
            return {
                category: "Number Line",
                categoryClass: "category-comparing",
                type: "interactive-numberline",
                targetValue: targetValue,
                tolerance: 0.05,
                question: `üëÜ <span class="translatable">Haz clic en la recta num√©rica para colocar<span class="translation">Click on the number line to place</span></span> <strong>${displayValue}</strong>
                <div class="number-line-interactive" id="interactiveNumberLine" onclick="placePoint(event)">
                    <div class="number-line-track"></div>
                    <div class="number-line-tick major" style="left: 0%;"></div>
                    <div class="number-line-label" style="left: 0%;">0</div>
                    <div class="number-line-tick" style="left: 10%;"></div>
                    <div class="number-line-tick" style="left: 20%;"></div>
                    <div class="number-line-tick" style="left: 30%;"></div>
                    <div class="number-line-tick" style="left: 40%;"></div>
                    <div class="number-line-tick major" style="left: 50%;"></div>
                    <div class="number-line-label" style="left: 50%;">0.5</div>
                    <div class="number-line-tick" style="left: 60%;"></div>
                    <div class="number-line-tick" style="left: 70%;"></div>
                    <div class="number-line-tick" style="left: 80%;"></div>
                    <div class="number-line-tick" style="left: 90%;"></div>
                    <div class="number-line-tick major" style="left: 100%;"></div>
                    <div class="number-line-label" style="left: 100%;">1</div>
                    <div class="user-point" id="userPoint"></div>
                </div>
                <p class="click-hint">üëÜ Click where ${displayValue} should go!</p>`,
                options: [],
                correct: null,
                explanation: `<strong>Placing ${displayValue}:</strong>
                <div class="step">${displayValue} is about ${Math.round(targetValue * 100)}% of the way</div>
                <div class="step">Between ${Math.floor(targetValue * 10) / 10} and ${Math.ceil(targetValue * 10) / 10}</div>`,
                isDynamic: true
            };
        }

        // Generate dynamic dual grid adding question
        function generateDualGridAdding() {
            const tenths = Math.floor(Math.random() * 7) + 2; // 2-8 tenths
            const hundredths = Math.floor(Math.random() * 80) + 10; // 10-89 hundredths
            const grid1Target = tenths * 10;
            const grid2Target = hundredths;
            const correctAnswer = grid1Target + grid2Target;
            
            // Generate wrong answers
            const wrong1 = tenths + hundredths; // Just add numerators
            const wrong2 = correctAnswer + 10;
            
            return {
                category: "Decimal Grids",
                categoryClass: "category-adding",
                type: "interactive-dual-grid",
                grid1Target: grid1Target,
                grid2Target: grid2Target,
                question: `üëÜ <span class="translatable">Sombrea las cuadr√≠culas para mostrar tu trabajo<span class="translation">Shade the grids to show your work</span></span>:<br><br>
                <span class="fraction"><span class="numerator">${tenths}</span><span class="denominator">10</span></span> + <span class="fraction"><span class="numerator">${hundredths}</span><span class="denominator">100</span></span> = ?
                <div class="decimal-grid-container">
                    <div>
                        <div class="decimal-grid-interactive" id="interactiveGrid1"></div>
                        <div class="grid-label"><span class="fraction"><span class="numerator">${tenths}</span><span class="denominator">10</span></span> = <span id="grid1Count">0</span>/100</div>
                    </div>
                    <div style="display: flex; align-items: center; font-size: 2rem; color: #333;">+</div>
                    <div>
                        <div class="decimal-grid-interactive grid-blue" id="interactiveGrid2"></div>
                        <div class="grid-label"><span class="fraction"><span class="numerator">${hundredths}</span><span class="denominator">100</span></span> = <span id="grid2Count">0</span>/100</div>
                    </div>
                </div>
                <p style="text-align: center; color: #666; font-size: 0.85rem;">üé® <span class="translatable">Sombrea y calcula el total<span class="translation">Shade and calculate the total</span></span>!</p>`,
                options: [
                    `<span class="fraction"><span class="numerator">${correctAnswer}</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">${wrong1}</span><span class="denominator">110</span></span>`,
                    `<span class="fraction"><span class="numerator">${wrong1}</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">${wrong2}</span><span class="denominator">100</span></span>`
                ],
                correct: 0,
                explanation: `<strong>Adding with Grids:</strong>
                <div class="step">Green: ${tenths}/10 = ${grid1Target}/100 (${grid1Target} squares)</div>
                <div class="step">Blue: ${hundredths}/100 (${hundredths} squares)</div>
                <div class="step">Total: ${grid1Target} + ${hundredths} = ${correctAnswer}/100 ‚úì</div>`,
                isDynamic: true
            };
        }

        // Generate ALL questions dynamically - 100% fresh each quiz!
        function generateAllQuestions() {
            // Clear static questions and build entirely fresh pool
            questions = [];
            
            // ORDERING DECIMALS - 3 different questions with random numbers
            questions.push(generateOrderingQuestion());
            questions.push(generateOrderingQuestion());
            questions.push(generateOrderingQuestion());
            
            // MIXED FORMATS - ordering fractions, decimals, mixed numbers
            questions.push(generateMixedFormatOrdering());
            questions.push(generateMixedFormatOrdering());
            
            // COMPARING DECIMALS - 4 different compare questions
            questions.push(generateWhichIsGreatestQuestion());
            questions.push(generateComparingQuestion());
            questions.push(generateComparingQuestion());
            questions.push(generateCompareWithNumberLine());
            
            // CONVERTING - fraction to decimal
            questions.push(generateFractionToDecimal());
            questions.push(generateFractionToDecimal());
            questions.push(generateDecimalToFractionQuestion());
            questions.push(generateDecimalToFractionQuestion());
            questions.push(generateMixedFractionToDecimal());
            questions.push(generateMixedFractionToDecimal());
            questions.push(generateWatermelonQuestion());
            
            // ADDING FRACTIONS - /10 + /100
            questions.push(generateAddingFractions());
            questions.push(generateAddingFractions());
            questions.push(generateAddingFractions());
            questions.push(generateSelectAllAddition());
            questions.push(generateEquivalentFormsQuestion()); // mixed number = improper fraction
            
            // NUMBER LINES - interactive
            questions.push(generateClickNumberLine());
            questions.push(generateFillNumberLine());
            questions.push(generateTwoPointComparison());
            
            // DECIMAL GRIDS - interactive
            questions.push(generateInteractiveGrid());
            questions.push(generateDualGridAdding());
            questions.push(generateReadGridQuestion());
            questions.push(generateTenthsGridQuestion());      // Grid split into 10s
            questions.push(generateMixedGridAddition());       // One /10 grid + one /100 grid (like Q9)
            
            console.log(`Generated ${questions.length} fresh questions!`);
        }
        
        // Generate mixed format ordering question (fractions + decimals)
        function generateMixedFormatOrdering() {
            const tenth = Math.floor(Math.random() * 8) + 1;
            const hundredth = Math.floor(Math.random() * 80) + 10;
            const decimal = (Math.random() * 0.4 + 0.01).toFixed(2);
            const mixed = Math.floor(Math.random() * 2) + 1;
            const mixedFrac = Math.floor(Math.random() * 90) + 5;
            
            const items = [
                { display: `<span class="fraction"><span class="numerator">${tenth}</span><span class="denominator">10</span></span>`, value: tenth / 10 },
                { display: decimal, value: parseFloat(decimal) },
                { display: `<span class="fraction"><span class="numerator">${hundredth}</span><span class="denominator">100</span></span>`, value: hundredth / 100 },
                { display: `<span class="mixed-number">${mixed}<span class="fraction"><span class="numerator">${mixedFrac}</span><span class="denominator">100</span></span></span>`, value: mixed + mixedFrac / 100 }
            ];
            
            const shuffled = shuffle([...items]);
            const sorted = [...shuffled].sort((a, b) => a.value - b.value);
            const wrong1 = shuffle([...shuffled]);
            const wrong2 = [...sorted].reverse();
            
            return {
                category: "Mixed Formats",
                categoryClass: "category-ordering",
                question: `<span class="translatable">Ordena de menor a mayor<span class="translation">Order from least to greatest</span></span>:<br><br>${shuffled.map(i => i.display).join(', &nbsp;')}`,
                options: [
                    sorted.map(i => i.display).join(', '),
                    wrong2.map(i => i.display).join(', '),
                    wrong1.map(i => i.display).join(', '),
                    shuffle([...shuffled]).map(i => i.display).join(', ')
                ],
                correct: 0,
                explanation: `<strong>Convert ALL to decimals:</strong>
                <div class="step">${sorted.map(i => `${i.display.replace(/<[^>]*>/g, '')} = ${i.value.toFixed(2)}`).join('<br>')}</div>
                <div class="step">Order: ${sorted.map(i => i.value.toFixed(2)).join(' < ')} ‚úì</div>`
            };
        }
        
        // Generate fraction to decimal conversion
        function generateFractionToDecimal() {
            const isTenths = Math.random() > 0.5;
            const num = isTenths ? Math.floor(Math.random() * 8) + 1 : Math.floor(Math.random() * 90) + 5;
            const denom = isTenths ? 10 : 100;
            const correctDecimal = (num / denom).toFixed(2).replace(/\.?0+$/, '') || '0';
            
            let wrongOptions;
            if (isTenths) {
                wrongOptions = [
                    `0.0${num}`,
                    `${num}.0`,
                    `0.${num}0`
                ];
            } else {
                wrongOptions = [
                    `0.${Math.floor(num/10)}`,
                    `${(num/10).toFixed(1)}`,
                    `0.0${num % 10}`
                ];
            }
            
            const options = shuffle([correctDecimal, ...wrongOptions.slice(0, 3)]);
            
            return {
                category: "Converting",
                categoryClass: "category-converting",
                question: `<span class="translatable">Convierte<span class="translation">Convert</span></span> <span class="fraction"><span class="numerator">${num}</span><span class="denominator">${denom}</span></span> <span class="translatable">a decimal<span class="translation">to decimal</span></span>:`,
                options: options,
                correct: options.indexOf(correctDecimal),
                explanation: `<strong>Converting ${num}/${denom}:</strong>
                <div class="step">${num}/${denom} = ${num} ${isTenths ? 'tenths' : 'hundredths'} = ${correctDecimal} ‚úì</div>
                <p>üí° /${denom} means ${isTenths ? 'tenths' : 'hundredths'} place!</p>`
            };
        }
        
        // Generate mixed fraction to decimal
        function generateMixedFractionToDecimal() {
            const whole = Math.floor(Math.random() * 3) + 1;
            const frac = Math.floor(Math.random() * 85) + 10; // 10-94 to avoid edge cases
            const correctDecimal = (whole + frac / 100).toFixed(2);
            
            // Create clearly different wrong answers
            const wrong1 = (whole + frac / 10).toFixed(2); // Wrong: treating as tenths
            const wrong2 = (frac / 100).toFixed(2); // Wrong: forgot whole number
            const wrong3 = (whole * 10 + frac / 10).toFixed(2); // Wrong: multiplication error
            
            // Filter out any that match the correct answer
            const wrongOptions = [wrong1, wrong2, wrong3].filter(w => w !== correctDecimal);
            
            // Take first 3 unique wrong answers
            const uniqueWrong = [...new Set(wrongOptions)].slice(0, 3);
            
            const options = shuffle([correctDecimal, ...uniqueWrong]);
            
            return {
                category: "Converting",
                categoryClass: "category-converting",
                question: `<span class="translatable">Convierte<span class="translation">Convert</span></span> <span class="mixed-number">${whole}<span class="fraction"><span class="numerator">${frac}</span><span class="denominator">100</span></span></span> <span class="translatable">a decimal<span class="translation">to decimal</span></span>:`,
                options: options,
                correct: options.indexOf(correctDecimal),
                explanation: `<strong>Converting Mixed Fractions:</strong>
                <div class="step">${whole} ${frac}/100 = ${whole} + ${frac}/100</div>
                <div class="step">${frac}/100 = ${(frac/100).toFixed(2)}</div>
                <div class="step">${whole} + ${(frac/100).toFixed(2)} = ${correctDecimal} ‚úì</div>`
            };
        }
        
        // Generate number line comparison (two values shown)
        function generateCompareWithNumberLine() {
            const a = (Math.random() * 0.4 + 0.3).toFixed(2);
            const b = (Math.random() * 0.3 + 0.1).toFixed(2);
            const aPos = parseFloat(a) * 100;
            const bPos = parseFloat(b) * 100;
            
            let correct, symbol;
            if (parseFloat(a) > parseFloat(b)) { correct = 1; symbol = '>'; }
            else if (parseFloat(a) < parseFloat(b)) { correct = 0; symbol = '<'; }
            else { correct = 2; symbol = '='; }
            
            return {
                category: "Number Line",
                categoryClass: "category-comparing",
                question: `<span class="translatable">Mira la recta num√©rica<span class="translation">Look at the number line</span></span>. ¬ø<span class="translatable">Cu√°l es mayor<span class="translation">Which is greater</span></span>?
                <div class="number-line">
                    <div class="number-line-track"></div>
                    <div class="number-line-tick major" style="left: 0%;"></div>
                    <div class="number-line-label" style="left: 0%;">0</div>
                    <div class="number-line-tick major" style="left: 50%;"></div>
                    <div class="number-line-label" style="left: 50%;">0.5</div>
                    <div class="number-line-tick major" style="left: 100%;"></div>
                    <div class="number-line-label" style="left: 100%;">1</div>
                    <div class="number-line-point" style="left: ${aPos}%;"><span class="point-label">${a}</span></div>
                    <div class="number-line-point blue" style="left: ${bPos}%;"><span class="point-label">${b}</span></div>
                </div>`,
                options: [`${a} < ${b}`, `${a} > ${b}`, `${a} = ${b}`],
                correct: correct,
                explanation: `<strong>Reading Number Line:</strong>
                <div class="step">${a} is at ${aPos}% on the line</div>
                <div class="step">${b} is at ${bPos}% on the line</div>
                <div class="step">${a} ${symbol} ${b} ‚úì</div>`
            };
        }
        
        // Generate two-point placement question
        function generateTwoPointComparison() {
            const big = (Math.random() * 0.3 + 0.6).toFixed(2);
            const small = (Math.random() * 0.15 + 0.02).toFixed(2);
            
            return {
                category: "Number Line",
                categoryClass: "category-comparing",
                type: "place-two-points",
                point1: { value: parseFloat(big), label: big },
                point2: { value: parseFloat(small), label: small },
                question: `üëÜ <span class="translatable">Coloca los dos n√∫meros en la recta num√©rica<span class="translation">Place both numbers on the number line</span></span>, <span class="translatable">luego compara<span class="translation">then compare</span></span>:
                <div class="number-line-interactive" id="twoPointNumberLine" style="height: 100px;">
                    <div class="number-line-track"></div>
                    <div class="number-line-tick major" style="left: 0%;"></div>
                    <div class="number-line-label" style="left: 0%;">0</div>
                    <div class="number-line-tick" style="left: 10%;"></div>
                    <div class="number-line-tick" style="left: 20%;"></div>
                    <div class="number-line-tick" style="left: 30%;"></div>
                    <div class="number-line-tick" style="left: 40%;"></div>
                    <div class="number-line-tick major" style="left: 50%;"></div>
                    <div class="number-line-label" style="left: 50%;">0.5</div>
                    <div class="number-line-tick" style="left: 60%;"></div>
                    <div class="number-line-tick" style="left: 70%;"></div>
                    <div class="number-line-tick" style="left: 80%;"></div>
                    <div class="number-line-tick" style="left: 90%;"></div>
                    <div class="number-line-tick major" style="left: 100%;"></div>
                    <div class="number-line-label" style="left: 100%;">1</div>
                </div>
                <div style="text-align: center; margin: 10px 0;">
                    <button class="point-btn" id="placePoint1Btn" onclick="selectPointToPlace(1)" style="background: #e91e63; color: white; border: none; padding: 8px 16px; border-radius: 20px; margin: 5px; cursor: pointer;">üìç Place ${big}</button>
                    <button class="point-btn" id="placePoint2Btn" onclick="selectPointToPlace(2)" style="background: #2196F3; color: white; border: none; padding: 8px 16px; border-radius: 20px; margin: 5px; cursor: pointer;">üìç Place ${small}</button>
                </div>
                <p style="text-align: center; color: #666; font-size: 0.85rem;" id="placeHint">Click a button, then click the number line!</p>
                <br>${big} ___ ${small}`,
                options: [`${big} < ${small}`, `${big} > ${small}`, `${big} = ${small}`],
                correct: 1,
                explanation: `<strong>Look at the positions!</strong>
                <div class="step">${big} should be far right (${(parseFloat(big)*100).toFixed(0)}%)</div>
                <div class="step">${small} should be near 0 (${(parseFloat(small)*100).toFixed(0)}%)</div>
                <div class="step">${big} > ${small} ‚úì</div>
                <p>üí∞ Think money: $${big} vs $${small}</p>`
            };
        }
        
        // Generate select-all addition question
        function generateSelectAllAddition() {
            const num1 = Math.floor(Math.random() * 5) + 5; // 5-9 for /10
            // Use multiples of 10 so we get clean fractions (no decimals in fractions!)
            const num2 = (Math.floor(Math.random() * 5) + 2) * 10; // 20, 30, 40, 50, 60
            const total = (num1 * 10) + num2;
            const overflow = total > 100;
            const remainder = total - 100;
            
            // Only use whole number fractions - NO decimals in fractions!
            let correctAnswers;
            if (overflow) {
                correctAnswers = [
                    `<span class="fraction"><span class="numerator">${total}</span><span class="denominator">100</span></span>`,
                    `<span class="mixed-number">1<span class="fraction"><span class="numerator">${remainder}</span><span class="denominator">100</span></span></span>`,
                    `<span class="mixed-number">1<span class="fraction"><span class="numerator">${remainder / 10}</span><span class="denominator">10</span></span></span>`
                ];
            } else {
                correctAnswers = [
                    `<span class="fraction"><span class="numerator">${total}</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">${total / 10}</span><span class="denominator">10</span></span>`
                ];
            }
            
            const wrongAnswer = `<span class="fraction"><span class="numerator">${num1 + (num2 / 10)}</span><span class="denominator">110</span></span>`;
            const wrongAnswer2 = `<span class="fraction"><span class="numerator">${num1 + (num2 / 10)}</span><span class="denominator">100</span></span>`;
            
            const allOptions = [...correctAnswers, wrongAnswer, wrongAnswer2];
            const options = shuffle(allOptions);
            const correctIndices = correctAnswers.map(c => options.indexOf(c)).filter(i => i >= 0);
            
            return {
                category: "Adding Fractions",
                categoryClass: "category-adding",
                type: "select-all",
                question: `<span class="fraction"><span class="numerator">${num1}</span><span class="denominator">10</span></span> + <span class="fraction"><span class="numerator">${num2}</span><span class="denominator">100</span></span> = ?<br><br>üîò <span class="translatable">Selecciona TODAS las respuestas correctas<span class="translation">Select ALL correct answers</span></span>:`,
                options: options,
                correct: correctIndices,
                explanation: `<strong>Steps:</strong>
                <div class="step">${num1}/10 = ${num1 * 10}/100</div>
                <div class="step">${num1 * 10}/100 + ${num2}/100 = ${total}/100 ‚úì</div>
                ${overflow ? `<div class="step">${total}/100 = 1 ${remainder}/100 = 1 ${remainder/10}/10 ‚úì</div>` : ''}
                <p>‚ö†Ô∏è Don't add denominators! 10 + 100 ‚â† 110</p>`
            };
        }
        
        // Generate grid reading question
        function generateReadGridQuestion() {
            const shaded = Math.floor(Math.random() * 70) + 20;
            const decimal = (shaded / 100).toFixed(2);
            const decimalShort = parseFloat(decimal).toString();
            
            // Create unique wrong answers
            const wrong1 = `0.0${shaded % 10}`;
            const wrong2 = `${shaded}.0`;
            
            // For select-all, both 0.56 and 0.56 are same - use only one correct format
            // Actually make this a SINGLE answer question to avoid confusion
            const options = shuffle([
                decimal,
                wrong1,
                wrong2,
                (shaded / 10).toFixed(1) // e.g., 5.6 instead of 0.56
            ]);
            
            return {
                category: "Decimal Grids",
                categoryClass: "category-converting",
                question: `¬ø<span class="translatable">Qu√© decimal representa esta cuadr√≠cula<span class="translation">What decimal does this grid represent</span></span>?
                <div class="decimal-grid-container">
                    <div>
                        <div class="decimal-grid">
                            ${Array(100).fill(0).map((_, i) => `<div class="cell ${i < shaded ? 'shaded' : ''}"></div>`).join('')}
                        </div>
                        <div class="grid-label">${shaded} <span class="translatable">cuadrados sombreados<span class="translation">squares shaded</span></span></div>
                    </div>
                </div>`,
                options: options,
                correct: options.indexOf(decimal),
                explanation: `<strong>Reading the Grid:</strong>
                <div class="step">${shaded} out of 100 squares are shaded</div>
                <div class="step">${shaded}/100 = ${decimal} ‚úì</div>
                <p>üí° 100 squares total, so shaded/100 = decimal!</p>`
            };
        }
        
        // Generate tenths grid question (10 columns, not 100 squares)
        function generateTenthsGridQuestion() {
            const tenths = Math.floor(Math.random() * 7) + 2; // 2-8 tenths
            
            return {
                category: "Decimal Grids",
                categoryClass: "category-converting",
                type: "interactive-tenths-grid",
                targetShaded: tenths,
                question: `üé® <span class="translatable">Sombrea<span class="translation">Shade</span></span> <span class="fraction"><span class="numerator">${tenths}</span><span class="denominator">10</span></span>
                <div class="decimal-grid-container">
                    <div>
                        <div class="tenths-grid-interactive" id="tenthsGrid"></div>
                        <div class="shade-counter"><span id="tenthsShadedCount">0</span>/10 <span class="translatable">sombreados<span class="translation">shaded</span></span></div>
                    </div>
                </div>
                <p style="text-align: center; color: #666; font-size: 0.85rem;">üí° <span class="translatable">Cada columna<span class="translation">Each column</span></span> = 1/10</p>`,
                options: [],
                correct: null,
                explanation: `<strong>Shading ${tenths}/10:</strong>
                <div class="step">This grid has 10 equal parts (tenths)</div>
                <div class="step">Shade ${tenths} columns = ${tenths}/10 ‚úì</div>
                <p>üí° ${tenths}/10 = ${(tenths/10).toFixed(1)}</p>`
            };
        }

        // Generate mixed grid addition (one /10 grid + one /100 grid) - like Question 9
        function generateMixedGridAddition() {
            const tenths = Math.floor(Math.random() * 6) + 2; // 2-7 for /10 grid
            const hundredths = Math.floor(Math.random() * 80) + 10; // 10-89 for /100 grid
            const total = (tenths * 10) + hundredths;
            
            return {
                category: "Decimal Grids",
                categoryClass: "category-adding",
                type: "interactive-mixed-grids",
                tenthsTarget: tenths,
                hundredthsTarget: hundredths,
                question: `üé® <span class="translatable">Sombrea las cuadr√≠culas para mostrar<span class="translation">Shade the grids to show</span></span>:
                <br><span class="fraction"><span class="numerator">${tenths}</span><span class="denominator">10</span></span> + <span class="fraction"><span class="numerator">${hundredths}</span><span class="denominator">100</span></span> = ?
                <div class="decimal-grid-container" style="gap: 20px;">
                    <div>
                        <div class="tenths-grid-interactive" id="mixedTenthsGrid"></div>
                        <div class="grid-label"><span class="fraction"><span class="numerator">${tenths}</span><span class="denominator">10</span></span></div>
                        <div class="shade-counter" style="color: #4CAF50;"><span id="mixedTenthsCount">0</span>/10</div>
                    </div>
                    <div style="font-size: 2rem; display: flex; align-items: center;">+</div>
                    <div>
                        <div class="decimal-grid-interactive grid-blue" id="mixedHundredthsGrid"></div>
                        <div class="grid-label"><span class="fraction"><span class="numerator">${hundredths}</span><span class="denominator">100</span></span></div>
                        <div class="shade-counter" style="color: #2196F3;"><span id="mixedHundredthsCount">0</span>/100</div>
                    </div>
                </div>
                <p style="text-align: center; color: #666; font-size: 0.85rem; margin-top: 15px;">üí° <span class="translatable">Recuerda<span class="translation">Remember</span></span>: 1/10 = 10/100 ‚Äî <span class="translatable">Ahora calcula el total<span class="translation">Now calculate the total</span></span>!</p>`,
                options: [
                    `<span class="fraction"><span class="numerator">${total}</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">${tenths + hundredths}</span><span class="denominator">110</span></span>`,
                    `<span class="fraction"><span class="numerator">${tenths + hundredths}</span><span class="denominator">100</span></span>`,
                    `<span class="fraction"><span class="numerator">${total + 10}</span><span class="denominator">100</span></span>`
                ],
                correct: 0,
                explanation: `<strong>Adding with Different Grids:</strong>
                <div class="step">Tenths grid: ${tenths}/10 = ${tenths * 10}/100</div>
                <div class="step">Hundredths grid: ${hundredths}/100</div>
                <div class="step">${tenths * 10}/100 + ${hundredths}/100 = ${total}/100 ‚úì</div>
                <p>üîë Convert tenths to hundredths first: √ó10!</p>`
            };
        }

        // Generate question testing equivalent forms (improper fraction = mixed number)
        function generateEquivalentFormsQuestion() {
            // Generate a sum that goes over 100 (so it can be written as mixed number)
            // Use multiples of 10 for hundredths so simplified form works nicely
            const tenths = Math.floor(Math.random() * 4) + 6; // 6-9 for /10
            const hundredths = (Math.floor(Math.random() * 5) + 3) * 10; // 30, 40, 50, 60, 70
            const total = (tenths * 10) + hundredths; // Will be > 100
            const remainder = total - 100;
            
            // Correct answers: improper fraction AND mixed number (only whole number fractions!)
            const improperFraction = `<span class="fraction"><span class="numerator">${total}</span><span class="denominator">100</span></span>`;
            const mixedNumber = `<span class="mixed-number">1<span class="fraction"><span class="numerator">${remainder}</span><span class="denominator">100</span></span></span>`;
            // Only include simplified if remainder divides evenly by 10
            const mixedSimplified = `<span class="mixed-number">1<span class="fraction"><span class="numerator">${remainder / 10}</span><span class="denominator">10</span></span></span>`;
            
            // Wrong answers
            const wrongDenom = `<span class="fraction"><span class="numerator">${tenths + (hundredths / 10)}</span><span class="denominator">110</span></span>`;
            const wrongNoConvert = `<span class="fraction"><span class="numerator">${tenths + (hundredths / 10)}</span><span class="denominator">100</span></span>`;
            
            // All correct answers are equivalent - pick 2 or 3
            const correctAnswers = [improperFraction, mixedNumber, mixedSimplified];
            
            const allOptions = [...correctAnswers, wrongDenom, wrongNoConvert];
            const options = shuffle(allOptions);
            
            // Find indices of correct answers
            const correctIndices = correctAnswers.map(c => options.indexOf(c)).filter(i => i >= 0);
            
            return {
                category: "Adding Fractions",
                categoryClass: "category-adding",
                type: "select-all",
                question: `<span class="fraction"><span class="numerator">${tenths}</span><span class="denominator">10</span></span> + <span class="fraction"><span class="numerator">${hundredths}</span><span class="denominator">100</span></span> = ?<br><br>
                üîò <span class="translatable">Selecciona TODAS las respuestas equivalentes<span class="translation">Select ALL equivalent answers</span></span>:`,
                options: options,
                correct: correctIndices,
                explanation: `<strong>Finding Equivalent Forms:</strong>
                <div class="step">${tenths}/10 = ${tenths * 10}/100</div>
                <div class="step">${tenths * 10}/100 + ${hundredths}/100 = ${total}/100 ‚úì</div>
                <div class="step">${total}/100 = 1 ${remainder}/100 = 1 ${remainder/10}/10 ‚úì</div>
                <p>üí° All THREE are the SAME: <strong>${total}/100 = 1 ${remainder}/100 = 1 ${remainder/10}/10</strong></p>
                <p>‚ö†Ô∏è Don't add denominators! 10 + 100 ‚â† 110</p>`
            };
        }

        // Add alias for backward compatibility
        function addDynamicQuestions() {
            generateAllQuestions();
        }

        // ==========================================
        // INTERACTIVE ELEMENT HANDLERS
        // ==========================================
        
        let userPlacedValue = null;
        let userShadedCount = 0;
        let placingPointNumber = null;
        let placedPoints = { 1: null, 2: null };

        // Place point on number line (single point)
        function placePoint(event) {
            if (answered) return;
            
            const line = document.getElementById('interactiveNumberLine');
            const rect = line.getBoundingClientRect();
            const padding = 20;
            const effectiveWidth = rect.width - (padding * 2);
            const clickX = event.clientX - rect.left - padding;
            
            let percentage = Math.max(0, Math.min(1, clickX / effectiveWidth));
            userPlacedValue = percentage;
            
            const userPoint = document.getElementById('userPoint');
            userPoint.style.left = (percentage * 100) + '%';
            userPoint.classList.add('placed');
            
            const hint = document.querySelector('.click-hint');
            if (hint) {
                hint.textContent = `üìç You placed: ${percentage.toFixed(2)}`;
            }
            
            document.getElementById('submitBtn').disabled = false;
        }

        // Select which point to place (for two-point questions)
        function selectPointToPlace(pointNum) {
            if (answered) return;
            placingPointNumber = pointNum;
            
            // Update button styles
            document.getElementById('placePoint1Btn').style.opacity = pointNum === 1 ? '1' : '0.5';
            document.getElementById('placePoint2Btn').style.opacity = pointNum === 2 ? '1' : '0.5';
            
            const q = shuffledQuestions[currentQuestion];
            const label = pointNum === 1 ? q.point1.label : q.point2.label;
            document.getElementById('placeHint').textContent = `üëÜ Now click the number line to place ${label}`;
        }

        // Place point on two-point number line
        function placeTwoPointNumberLine(event) {
            if (answered || !placingPointNumber) return;
            
            const line = document.getElementById('twoPointNumberLine');
            const rect = line.getBoundingClientRect();
            const padding = 30;
            const effectiveWidth = rect.width - (padding * 2);
            const clickX = event.clientX - rect.left - padding;
            
            let percentage = Math.max(0, Math.min(1, clickX / effectiveWidth));
            placedPoints[placingPointNumber] = percentage;
            
            // Create or update the point marker
            const pointId = `userPoint${placingPointNumber}`;
            let point = document.getElementById(pointId);
            
            if (!point) {
                point = document.createElement('div');
                point.id = pointId;
                point.className = `number-line-point ${placingPointNumber === 1 ? '' : 'blue'} placed`;
                line.appendChild(point);
            }
            
            const q = shuffledQuestions[currentQuestion];
            const label = placingPointNumber === 1 ? q.point1.label : q.point2.label;
            point.innerHTML = `<span class="point-label">${label}</span>`;
            point.style.left = (percentage * 100) + '%';
            point.classList.add('placed');
            
            // Mark button as done
            const btn = document.getElementById(`placePoint${placingPointNumber}Btn`);
            btn.textContent = `‚úì ${label} placed`;
            btn.style.opacity = '0.7';
            
            // Check if both points placed
            if (placedPoints[1] !== null && placedPoints[2] !== null) {
                document.getElementById('placeHint').textContent = '‚úÖ Both points placed! Now select your answer.';
            }
            
            placingPointNumber = null;
        }

        // Setup two-point number line
        function setupTwoPointNumberLine() {
            placedPoints = { 1: null, 2: null };
            placingPointNumber = null;
            
            const line = document.getElementById('twoPointNumberLine');
            if (line) {
                line.onclick = placeTwoPointNumberLine;
                
                // Remove any existing user points
                const existingPoints = line.querySelectorAll('.number-line-point.placed');
                existingPoints.forEach(p => p.remove());
            }
            
            // Reset buttons
            const btn1 = document.getElementById('placePoint1Btn');
            const btn2 = document.getElementById('placePoint2Btn');
            if (btn1 && btn2) {
                const q = shuffledQuestions[currentQuestion];
                btn1.textContent = `üìç Place ${q.point1.label}`;
                btn2.textContent = `üìç Place ${q.point2.label}`;
                btn1.style.opacity = '1';
                btn2.style.opacity = '1';
            }
        }

        // Setup interactive grid (single)
        // Drag state for grid shading
        let isDragging = false;
        let dragMode = null; // 'shade' or 'unshade'
        let currentDragGrid = null;

        function setupInteractiveGrid() {
            const grid = document.getElementById('interactiveGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            userShadedCount = 0;
            
            for (let i = 0; i < 100; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                
                // Click to toggle
                cell.onclick = (e) => {
                    if (!isDragging) toggleCell(cell, 'interactiveGrid');
                };
                
                // Drag support
                cell.onmousedown = (e) => {
                    e.preventDefault();
                    isDragging = true;
                    currentDragGrid = 'interactiveGrid';
                    // Determine mode based on current cell state
                    dragMode = cell.classList.contains('user-shaded') ? 'unshade' : 'shade';
                    applyDragMode(cell, 'interactiveGrid');
                };
                
                cell.onmouseenter = () => {
                    if (isDragging && currentDragGrid === 'interactiveGrid') {
                        applyDragMode(cell, 'interactiveGrid');
                    }
                };
                
                // Touch support for mobile
                cell.ontouchstart = (e) => {
                    e.preventDefault();
                    toggleCell(cell, 'interactiveGrid');
                };
                
                grid.appendChild(cell);
            }
            
            // Stop dragging when mouse is released
            document.addEventListener('mouseup', stopDragging);
            
            updateShadedCounter();
        }

        function stopDragging() {
            isDragging = false;
            dragMode = null;
            currentDragGrid = null;
        }

        function applyDragMode(cell, gridId) {
            if (answered) return;
            
            if (dragMode === 'shade' && !cell.classList.contains('user-shaded')) {
                cell.classList.add('user-shaded');
                updateGridCounter(gridId);
            } else if (dragMode === 'unshade' && cell.classList.contains('user-shaded')) {
                cell.classList.remove('user-shaded');
                updateGridCounter(gridId);
            }
        }

        function updateGridCounter(gridId) {
            if (gridId === 'interactiveGrid') {
                updateShadedCounter();
            } else {
                updateDualGridCounters();
            }
        }

        // Setup dual interactive grids (for adding fractions)
        function setupDualGrids() {
            const grid1 = document.getElementById('interactiveGrid1');
            const grid2 = document.getElementById('interactiveGrid2');
            if (!grid1 || !grid2) return;
            
            [grid1, grid2].forEach((grid, idx) => {
                const gridId = idx === 0 ? 'interactiveGrid1' : 'interactiveGrid2';
                grid.innerHTML = '';
                
                for (let i = 0; i < 100; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    
                    // Click to toggle
                    cell.onclick = (e) => {
                        if (!isDragging) toggleCell(cell, gridId);
                    };
                    
                    // Drag support
                    cell.onmousedown = (e) => {
                        e.preventDefault();
                        isDragging = true;
                        currentDragGrid = gridId;
                        dragMode = cell.classList.contains('user-shaded') ? 'unshade' : 'shade';
                        applyDragMode(cell, gridId);
                    };
                    
                    cell.onmouseenter = () => {
                        if (isDragging && currentDragGrid === gridId) {
                            applyDragMode(cell, gridId);
                        }
                    };
                    
                    // Touch support
                    cell.ontouchstart = (e) => {
                        e.preventDefault();
                        toggleCell(cell, gridId);
                    };
                    
                    grid.appendChild(cell);
                }
            });
            
            updateDualGridCounters();
        }

        // Setup tenths grid (10 columns) - SIMPLE CLICK ONLY
        function setupTenthsGrid(gridId, counterId) {
            const grid = document.getElementById(gridId);
            if (!grid) return;
            
            grid.innerHTML = '';
            
            for (let i = 0; i < 10; i++) {
                const column = document.createElement('div');
                column.className = 'column';
                
                // Simple click to toggle
                column.addEventListener('click', function() {
                    if (answered) return;
                    this.classList.toggle('user-shaded');
                    updateTenthsCounter(gridId, counterId);
                    enableSubmitIfNeeded();
                });
                
                grid.appendChild(column);
            }
            
            updateTenthsCounter(gridId, counterId);
        }

        function updateTenthsCounter(gridId, counterId) {
            const grid = document.getElementById(gridId);
            const counter = document.getElementById(counterId);
            if (grid && counter) {
                const count = grid.querySelectorAll('.column.user-shaded').length;
                counter.textContent = count;
            }
            
            // Update mixed grid totals if applicable
            updateMixedGridTotals();
        }
        
        function enableSubmitIfNeeded() {
            // Enable submit button when any grid has shading
            const submitBtn = document.getElementById('submitBtn');
            if (!submitBtn) return;
            
            const tenthsGrid = document.getElementById('tenthsGrid');
            const mixedTenthsGrid = document.getElementById('mixedTenthsGrid');
            
            if (tenthsGrid) {
                const count = tenthsGrid.querySelectorAll('.column.user-shaded').length;
                submitBtn.disabled = count === 0;
            } else if (mixedTenthsGrid) {
                // For mixed grids, enable when answer option is selected
                // (handled by selectOption)
            }
        }

        function updateMixedGridTotals() {
            const tenthsCount = document.getElementById('mixedTenthsCount');
            const hundredthsCount = document.getElementById('mixedHundredthsCount');
            const converted = document.getElementById('mixedTenthsConverted');
            const hundredthsTotal = document.getElementById('mixedHundredthsTotal');
            const grandTotal = document.getElementById('mixedGrandTotal');
            
            if (tenthsCount && hundredthsCount && converted && hundredthsTotal && grandTotal) {
                const tenths = parseInt(tenthsCount.textContent) || 0;
                const hundredths = parseInt(hundredthsCount.textContent) || 0;
                
                converted.textContent = tenths * 10;
                hundredthsTotal.textContent = hundredths;
                grandTotal.textContent = (tenths * 10) + hundredths;
            }
        }

        // Setup mixed grids (tenths + hundredths)
        function setupMixedGrids() {
            setupTenthsGrid('mixedTenthsGrid', 'mixedTenthsCount');
            setupInteractiveGridById('mixedHundredthsGrid', 'mixedHundredthsCount');
            updateMixedGridTotals();
        }

        // Setup interactive grid by ID (for mixed grids)
        function setupInteractiveGridById(gridId, counterId) {
            const grid = document.getElementById(gridId);
            if (!grid) return;
            
            grid.innerHTML = '';
            
            for (let i = 0; i < 100; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                
                cell.onclick = (e) => {
                    if (!isDragging) {
                        cell.classList.toggle('user-shaded');
                        updateGridCounterById(gridId, counterId);
                    }
                };
                
                cell.onmousedown = (e) => {
                    e.preventDefault();
                    isDragging = true;
                    currentDragGrid = gridId;
                    dragMode = cell.classList.contains('user-shaded') ? 'unshade' : 'shade';
                    applyDragModeById(cell, gridId, counterId);
                };
                
                cell.onmouseenter = () => {
                    if (isDragging && currentDragGrid === gridId) {
                        applyDragModeById(cell, gridId, counterId);
                    }
                };
                
                cell.ontouchstart = (e) => {
                    e.preventDefault();
                    cell.classList.toggle('user-shaded');
                    updateGridCounterById(gridId, counterId);
                };
                
                grid.appendChild(cell);
            }
        }

        function applyDragModeById(cell, gridId, counterId) {
            if (answered) return;
            
            if (dragMode === 'shade' && !cell.classList.contains('user-shaded')) {
                cell.classList.add('user-shaded');
                updateGridCounterById(gridId, counterId);
            } else if (dragMode === 'unshade' && cell.classList.contains('user-shaded')) {
                cell.classList.remove('user-shaded');
                updateGridCounterById(gridId, counterId);
            }
        }

        function updateGridCounterById(gridId, counterId) {
            const grid = document.getElementById(gridId);
            const counter = document.getElementById(counterId);
            if (grid && counter) {
                const count = grid.querySelectorAll('.cell.user-shaded').length;
                counter.textContent = count;
            }
            updateMixedGridTotals();
        }

        // Toggle grid cell
        function toggleCell(cell, gridId) {
            if (answered) return;
            
            cell.classList.toggle('user-shaded');
            
            // Update appropriate counter
            if (gridId === 'interactiveGrid') {
                userShadedCount = document.querySelectorAll('#interactiveGrid .cell.user-shaded').length;
                updateShadedCounter();
            } else {
                updateDualGridCounters();
            }
            
            // Enable submit
            const totalShaded = document.querySelectorAll('.decimal-grid-interactive .cell.user-shaded').length;
            document.getElementById('submitBtn').disabled = totalShaded === 0;
        }

        function updateShadedCounter() {
            const counter = document.getElementById('shadedCount');
            const grid = document.getElementById('interactiveGrid');
            if (counter && grid) {
                const count = grid.querySelectorAll('.cell.user-shaded').length;
                userShadedCount = count;
                counter.textContent = count;
                
                // Enable submit button when any squares are shaded
                const submitBtn = document.getElementById('submitBtn');
                if (submitBtn) {
                    submitBtn.disabled = count === 0;
                }
            }
        }

        function updateDualGridCounters() {
            const grid1Count = document.querySelectorAll('#interactiveGrid1 .cell.user-shaded').length;
            const grid2Count = document.querySelectorAll('#interactiveGrid2 .cell.user-shaded').length;
            
            const counter1 = document.getElementById('grid1Count');
            const counter2 = document.getElementById('grid2Count');
            
            // Show individual counts (not total - don't give away answer!)
            if (counter1) counter1.textContent = grid1Count;
            if (counter2) counter2.textContent = grid2Count;
        }

        // Check interactive answer
        function checkInteractiveAnswer(q) {
            if (q.type === 'interactive-numberline') {
                const target = q.targetValue;
                const tolerance = q.tolerance || 0.05;
                return Math.abs(userPlacedValue - target) <= tolerance;
            } else if (q.type === 'interactive-grid') {
                return userShadedCount === q.targetShaded;
            } else if (q.type === 'interactive-tenths-grid') {
                const grid = document.getElementById('tenthsGrid');
                const count = grid ? grid.querySelectorAll('.column.user-shaded').length : 0;
                return count === q.targetShaded;
            } else if (q.type === 'interactive-mixed-grids' || q.type === 'interactive-dual-grid') {
                // For grids with answer options, check the selected answer
                return selectedAnswers.length === 1 && selectedAnswers[0] === q.correct;
            } else if (q.type === 'fill-numberline') {
                return checkFillNumberLine(q);
            }
            return false;
        }

        // Check fill-in number line answers
        function checkFillNumberLine(q) {
            let allCorrect = true;
            for (const [inputId, correctVal] of Object.entries(q.answers)) {
                const input = document.getElementById(inputId);
                if (input) {
                    const userVal = input.value.trim();
                    // Accept various formats: 0.2, .2, 0.20
                    const isCorrect = parseFloat(userVal) === parseFloat(correctVal);
                    
                    if (isCorrect) {
                        input.classList.add('correct');
                        input.classList.remove('incorrect');
                    } else {
                        input.classList.add('incorrect');
                        input.classList.remove('correct');
                        allCorrect = false;
                    }
                }
            }
            return allCorrect;
        }

        // Setup fill-in number line inputs
        function setupFillNumberLine() {
            const inputs = document.querySelectorAll('.numberline-fill .label-input');
            inputs.forEach(input => {
                input.value = '';
                input.classList.remove('correct', 'incorrect');
                input.addEventListener('input', () => {
                    // Enable submit if any input has value
                    const hasValue = Array.from(inputs).some(i => i.value.trim() !== '');
                    document.getElementById('submitBtn').disabled = !hasValue;
                });
            });
        }

        // Shuffle array
        function shuffle(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Select questions with category balance
        function selectQuestions() {
            const categories = {};
            questions.forEach((q, idx) => {
                if (!categories[q.category]) categories[q.category] = [];
                categories[q.category].push({...q, originalIndex: idx});
            });

            const selected = [];
            const quotas = {
                "Ordering Decimals": 2,
                "Comparing Decimals": 2,
                "Number Line": 2,
                "Decimal Grids": 2,
                "Mixed Formats": 2,
                "Converting": 3,
                "Adding Fractions": 3
            };

            for (const [cat, quota] of Object.entries(quotas)) {
                if (categories[cat]) {
                    const shuffled = shuffle(categories[cat]);
                    selected.push(...shuffled.slice(0, quota));
                }
            }

            return shuffle(selected);
        }

        // Start Quiz
        function startQuiz() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('quizScreen').style.display = 'block';
            
            // Generate 100% fresh questions with random numbers each time!
            generateAllQuestions();
            
            shuffledQuestions = selectQuestions();
            currentQuestion = 0;
            score = 0;
            totalTimeUsed = 0;
            categoryScores = {};
            
            loadQuestion();
        }

        // Load Question
        function loadQuestion() {
            if (currentQuestion >= shuffledQuestions.length) {
                showResults();
                return;
            }

            const q = shuffledQuestions[currentQuestion];
            answered = false;
            selectedAnswers = [];  // Reset to empty array

            // Update progress
            document.getElementById('progress').textContent = 
                `Question ${currentQuestion + 1} of ${shuffledQuestions.length}`;
            document.getElementById('currentScore').textContent = `Score: ${score}`;

            // Set category badge
            const badge = document.getElementById('categoryBadge');
            badge.textContent = q.category;
            badge.className = `category-badge ${q.categoryClass}`;

            // Set question
            document.getElementById('questionText').innerHTML = q.question;

            // Check if this is a multi-select question
            const isMultiSelect = q.type === 'select-all';
            const correctIndices = Array.isArray(q.correct) ? q.correct : [q.correct];

            // Don't double-shuffle - generators already shuffle options
            // Just use the options and correct indices as-is
            q.shuffledCorrect = [...correctIndices];
            q.isMultiSelect = isMultiSelect;
            
            // Use options directly (already shuffled by generator)
            const displayOptions = q.options.map((opt, idx) => ({
                text: opt,
                isCorrect: correctIndices.includes(idx)
            }));

            // Render options
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            
            // Add multi-select hint if needed
            if (isMultiSelect) {
                const hint = document.createElement('div');
                hint.className = 'multi-select-hint';
                hint.textContent = 'üëÜ Click multiple answers!';
                container.appendChild(hint);
            }
            
            const letters = ['A', 'B', 'C', 'D', 'E', 'F'];
            
            displayOptions.forEach((opt, idx) => {
                const div = document.createElement('div');
                div.className = 'option';
                div.innerHTML = `
                    <span class="option-letter">${letters[idx]}</span>
                    <span>${opt.text}</span>
                `;
                div.onclick = () => selectOption(idx);
                container.appendChild(div);
            });

            // Reset UI
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('submitBtn').style.display = 'inline-block';
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('nextBtn').style.display = 'none';

            // Setup interactive elements after rendering
            setTimeout(() => {
                if (q.type === 'interactive-grid') {
                    setupInteractiveGrid();
                }
                if (q.type === 'interactive-dual-grid') {
                    setupDualGrids();
                }
                if (q.type === 'interactive-tenths-grid') {
                    setupTenthsGrid('tenthsGrid', 'tenthsShadedCount');
                    // Enable submit when any column is shaded
                    document.getElementById('submitBtn').disabled = false;
                }
                if (q.type === 'interactive-mixed-grids') {
                    setupMixedGrids();
                    // Has answer options, so submit handled by selectOption
                }
                if (q.type === 'interactive-numberline') {
                    userPlacedValue = null;
                    const userPoint = document.getElementById('userPoint');
                    if (userPoint) {
                        userPoint.classList.remove('placed');
                    }
                }
                if (q.type === 'fill-numberline') {
                    setupFillNumberLine();
                }
                if (q.type === 'place-two-points') {
                    setupTwoPointNumberLine();
                }
            }, 100);

            // Start timer
            startTimer();

            // Check translation toggle
            const toggle = document.getElementById('translationToggle');
            document.getElementById('questionCard').classList.toggle('show-translations', toggle.checked);
        }

        // Timer
        function startTimer() {
            clearInterval(timer);
            timeLeft = 120; // 2 minutes
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeLeft--;
                totalTimeUsed++;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    if (!answered) {
                        submitAnswer(true);
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const display = document.getElementById('timer');
            display.textContent = `‚è±Ô∏è ${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            display.classList.remove('warning', 'danger');
            if (timeLeft <= 30) {
                display.classList.add('danger');
            } else if (timeLeft <= 60) {
                display.classList.add('warning');
            }
        }

        // Select Option
        function selectOption(index) {
            if (answered) return;
            
            const q = shuffledQuestions[currentQuestion];
            
            if (q.isMultiSelect) {
                // Toggle selection for multi-select
                const pos = selectedAnswers.indexOf(index);
                if (pos === -1) {
                    selectedAnswers.push(index);
                } else {
                    selectedAnswers.splice(pos, 1);
                }
                document.querySelectorAll('.option').forEach((opt, idx) => {
                    opt.classList.toggle('selected', selectedAnswers.includes(idx));
                });
            } else {
                // Single select - replace selection
                selectedAnswers = [index];
                document.querySelectorAll('.option').forEach((opt, idx) => {
                    opt.classList.toggle('selected', idx === index);
                });
            }
            
            document.getElementById('submitBtn').disabled = selectedAnswers.length === 0;
        }

        // Submit Answer
        function submitAnswer(timedOut = false) {
            if (answered) return;
            answered = true;
            clearInterval(timer);

            const q = shuffledQuestions[currentQuestion];
            let isCorrect;
            
            // Check interactive questions differently
            if (q.type === 'interactive-numberline' || q.type === 'interactive-grid' || 
                q.type === 'interactive-tenths-grid' || q.type === 'fill-numberline' ||
                q.type === 'interactive-dual-grid') {
                isCorrect = checkInteractiveAnswer(q);
            } else {
                // Check if answers match (works for both single and multi-select)
                // Use numeric sort to ensure proper comparison
                const sortedSelected = [...selectedAnswers].sort((a, b) => a - b);
                const sortedCorrect = [...q.shuffledCorrect].sort((a, b) => a - b);
                isCorrect = sortedSelected.length === sortedCorrect.length &&
                    sortedSelected.every((val, idx) => val === sortedCorrect[idx]);
            }
            
            // Track category scores
            if (!categoryScores[q.category]) {
                categoryScores[q.category] = { correct: 0, total: 0 };
            }
            categoryScores[q.category].total++;
            
            if (isCorrect) {
                score++;
                categoryScores[q.category].correct++;
            }

            // Check two-point placement and give feedback
            if (q.type === 'place-two-points') {
                const line = document.getElementById('twoPointNumberLine');
                if (line) {
                    // Show correct positions
                    const correct1 = document.createElement('div');
                    correct1.className = 'number-line-point green';
                    correct1.style.left = (q.point1.value * 100) + '%';
                    correct1.innerHTML = `<span class="point-label">‚úì ${q.point1.label}</span>`;
                    line.appendChild(correct1);
                    
                    const correct2 = document.createElement('div');
                    correct2.className = 'number-line-point green';
                    correct2.style.left = (q.point2.value * 100) + '%';
                    correct2.innerHTML = `<span class="point-label">‚úì ${q.point2.label}</span>`;
                    line.appendChild(correct2);
                    
                    // Check accuracy
                    const tolerance = 0.08;
                    const point1Correct = placedPoints[1] !== null && Math.abs(placedPoints[1] - q.point1.value) <= tolerance;
                    const point2Correct = placedPoints[2] !== null && Math.abs(placedPoints[2] - q.point2.value) <= tolerance;
                    
                    const hint = document.getElementById('placeHint');
                    if (hint) {
                        if (point1Correct && point2Correct) {
                            hint.innerHTML = '‚úÖ <span style="color: #4CAF50;">Great job placing both points!</span>';
                        } else {
                            hint.innerHTML = 'üìç <span style="color: #ff9800;">Check the green markers for correct positions.</span>';
                        }
                    }
                }
            }

            // Check dual grid shading and give feedback
            if (q.type === 'interactive-dual-grid') {
                const grid1Count = document.querySelectorAll('#interactiveGrid1 .cell.user-shaded').length;
                const grid2Count = document.querySelectorAll('#interactiveGrid2 .cell.user-shaded').length;
                const grid1Correct = grid1Count === q.grid1Target;
                const grid2Correct = grid2Count === q.grid2Target;
                
                const counter1 = document.getElementById('grid1Count');
                const counter2 = document.getElementById('grid2Count');
                
                if (counter1) {
                    counter1.innerHTML = grid1Correct ? 
                        `<span style="color: #4CAF50;">‚úì ${grid1Count}</span>` :
                        `<span style="color: #f44336;">‚úó ${grid1Count} (should be ${q.grid1Target})</span>`;
                }
                if (counter2) {
                    counter2.innerHTML = grid2Correct ? 
                        `<span style="color: #4CAF50;">‚úì ${grid2Count}</span>` :
                        `<span style="color: #f44336;">‚úó ${grid2Count} (should be ${q.grid2Target})</span>`;
                }
            }

            // Show feedback
            if (q.type !== 'interactive-numberline' && q.type !== 'interactive-grid' && q.type !== 'fill-numberline') {
                const options = document.querySelectorAll('.option');
                options.forEach((opt, idx) => {
                    if (q.shuffledCorrect.includes(idx)) {
                        opt.classList.add('correct');
                    } else if (selectedAnswers.includes(idx)) {
                        opt.classList.add('incorrect');
                    }
                });
            } else {
                // Show result for interactive questions
                if (q.type === 'interactive-numberline') {
                    const line = document.getElementById('interactiveNumberLine');
                    if (line) {
                        // Show the correct position
                        const correctPoint = document.createElement('div');
                        correctPoint.className = 'number-line-point green';
                        correctPoint.style.left = (q.targetValue * 100) + '%';
                        correctPoint.innerHTML = '<span class="point-label">‚úì ' + q.targetValue + '</span>';
                        line.appendChild(correctPoint);
                    }
                } else if (q.type === 'interactive-grid') {
                    const counter = document.querySelector('.shade-counter');
                    if (counter) {
                        counter.innerHTML = isCorrect ? 
                            `<span style="color: #4CAF50;">‚úì ${userShadedCount}/100 - Correct!</span>` :
                            `<span style="color: #f44336;">‚úó ${userShadedCount}/100 - Should be ${q.targetShaded}/100</span>`;
                    }
                } else if (q.type === 'interactive-tenths-grid') {
                    const grid = document.getElementById('tenthsGrid');
                    const count = grid ? grid.querySelectorAll('.column.user-shaded').length : 0;
                    const counter = document.getElementById('tenthsShadedCount');
                    if (counter) {
                        counter.parentElement.innerHTML = isCorrect ? 
                            `<span style="color: #4CAF50;">‚úì ${count}/10 - Correct!</span>` :
                            `<span style="color: #f44336;">‚úó ${count}/10 - Should be ${q.targetShaded}/10</span>`;
                    }
                } else if (q.type === 'interactive-mixed-grids') {
                    const tenthsCount = parseInt(document.getElementById('mixedTenthsCount')?.textContent) || 0;
                    const hundredthsCount = parseInt(document.getElementById('mixedHundredthsCount')?.textContent) || 0;
                    const total = (tenthsCount * 10) + hundredthsCount;
                    const expected = (q.tenthsTarget * 10) + q.hundredthsTarget;
                    
                    const grandTotalEl = document.getElementById('mixedGrandTotal');
                    if (grandTotalEl) {
                        grandTotalEl.parentElement.innerHTML = isCorrect ?
                            `<span style="color: #4CAF50;">‚úì Total: ${total}/100 - Correct!</span>` :
                            `<span style="color: #f44336;">Shaded: ${total}/100 (Expected: ${expected}/100)</span>`;
                    }
                }
            }

            const feedback = document.getElementById('feedback');
            feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.style.display = 'block';
            
            document.getElementById('feedbackTitle').textContent = 
                timedOut ? '‚è∞ Time\'s Up!' : (isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect');
            document.getElementById('feedbackExplanation').innerHTML = q.explanation;

            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        // Next Question
        function nextQuestion() {
            currentQuestion++;
            loadQuestion();
        }

        // Show Results
        function showResults() {
            document.getElementById('quizScreen').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'block';

            const percentage = Math.round((score / shuffledQuestions.length) * 100);
            
            document.getElementById('finalScore').textContent = percentage + '%';
            document.getElementById('correctCount').textContent = score;
            document.getElementById('incorrectCount').textContent = shuffledQuestions.length - score;
            
            const minutes = Math.floor(totalTimeUsed / 60);
            const seconds = totalTimeUsed % 60;
            document.getElementById('totalTime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

            // Score circle color
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.className = 'score-circle';
            if (percentage >= 80) {
                scoreCircle.classList.add('good');
            } else if (percentage >= 60) {
                scoreCircle.classList.add('okay');
            } else {
                scoreCircle.classList.add('needs-work');
            }

            // Category breakdown
            const breakdown = document.getElementById('categoryBreakdown');
            breakdown.innerHTML = '<h3>üìä Score by Topic</h3>';
            
            const needsReview = [];
            
            for (const [category, data] of Object.entries(categoryScores)) {
                const catPercent = Math.round((data.correct / data.total) * 100);
                let scoreClass = 'excellent';
                if (catPercent < 60) {
                    scoreClass = 'needs-practice';
                    needsReview.push(category);
                } else if (catPercent < 80) {
                    scoreClass = 'good';
                }
                
                breakdown.innerHTML += `
                    <div class="category-row">
                        <span class="category-name">${category}</span>
                        <span class="category-score ${scoreClass}">${data.correct}/${data.total} (${catPercent}%)</span>
                    </div>
                `;
            }

            // Review recommendations
            const reviewSection = document.getElementById('reviewSection');
            const reviewList = document.getElementById('reviewList');
            
            if (needsReview.length > 0) {
                reviewSection.style.display = 'block';
                reviewList.innerHTML = '';
                
                const tips = {
                    "Ordering Decimals": "Practice writing decimals with the same number of places (add zeros). Example: 0.5 = 0.50",
                    "Comparing Decimals": "Convert to same decimal places first, then compare. Think about money!",
                    "Converting": "Remember: /10 = tenths (1 digit), /100 = hundredths (2 digits)",
                    "Adding Fractions": "SAME DENOMINATOR FIRST! Convert /10 to /100 by multiplying by 10.",
                    "Number Line": "Numbers get BIGGER as you go RIGHT on the number line. LEFT = smaller.",
                    "Decimal Grids": "Each grid has 100 squares. Count shaded squares and divide by 100.",
                    "Mixed Formats": "Convert everything to decimals first, then compare. 3/10 = 0.3, 1 5/100 = 1.05"
                };
                
                needsReview.forEach(cat => {
                    reviewList.innerHTML += `<li><strong>${cat}:</strong> ${tips[cat]}</li>`;
                });
            } else {
                reviewSection.style.display = 'none';
            }
        }

        // Restart Quiz
        function restartQuiz() {
            document.getElementById('resultsScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'block';
        }

        // Translation toggle handler
        document.getElementById('translationToggle').addEventListener('change', function() {
            document.getElementById('questionCard').classList.toggle('show-translations', this.checked);
        });
    </script>
</body>
</html>
